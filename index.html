<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema Financeiro Pessoal - Vers√£o Final</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
}

.screen {
  display: none;
  min-height: 100vh;
}

.screen.active {
  display: block;
}

/* ==================== TELA DE LOGIN ==================== */
.login-screen {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 20px;
}

.login-container {
  background: white;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  max-width: 450px;
  width: 100%;
  padding: 50px 40px;
}

.logo {
  text-align: center;
  margin-bottom: 30px;
}

.logo-icon {
  font-size: 64px;
  margin-bottom: 10px;
}

.login-container h1 {
  text-align: center;
  color: #667eea;
  font-size: 32px;
  margin-bottom: 10px;
}

.subtitle {
  text-align: center;
  color: #999;
  margin-bottom: 30px;
  font-size: 14px;
}

.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
  border-bottom: 2px solid #f0f0f0;
}

.tab {
  flex: 1;
  padding: 15px;
  text-align: center;
  cursor: pointer;
  color: #999;
  font-weight: 600;
  border-bottom: 3px solid transparent;
  transition: all 0.3s;
}

.tab.active {
  color: #667eea;
  border-bottom-color: #667eea;
}

.form-section {
  display: none;
}

.form-section.active {
  display: block;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  color: #333;
  font-weight: 600;
  margin-bottom: 8px;
  font-size: 14px;
}

.form-group input {
  width: 100%;
  padding: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  font-size: 14px;
  transition: all 0.3s;
}

.form-group input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.btn-primary {
  width: 100%;
  padding: 15px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 10px;
}

.btn-primary:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.message {
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
  display: none;
  font-size: 14px;
}

.message.success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
  display: block;
}

.message.error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
  display: block;
}

/* ==================== TELA DE PLANOS ==================== */
.plans-screen {
  padding: 40px 20px;
  min-height: 100vh;
}

.plans-container {
  max-width: 1200px;
  margin: 0 auto;
}

.plans-header {
  text-align: center;
  color: white;
  margin-bottom: 50px;
}

.plans-header h1 {
  font-size: 48px;
  margin-bottom: 15px;
  text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.plans-header p {
  font-size: 20px;
  opacity: 0.9;
}

.plans-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 30px;
  margin-bottom: 40px;
}

.plan-card {
  background: white;
  border-radius: 20px;
  padding: 40px 30px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  transition: transform 0.3s, box-shadow 0.3s;
  position: relative;
  cursor: pointer;
}

.plan-card:hover {
  transform: translateY(-10px);
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.plan-card.selected {
  border: 3px solid #667eea;
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
}

.plan-card.popular {
  border: 3px solid #ffd700;
  transform: scale(1.05);
}

.popular-badge {
  position: absolute;
  top: -15px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
  color: #000;
  padding: 8px 20px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 14px;
  box-shadow: 0 4px 15px rgba(255,215,0,0.4);
}

.plan-name {
  font-size: 28px;
  font-weight: 700;
  color: #333;
  margin-bottom: 10px;
}

.plan-price {
  margin-bottom: 30px;
}

.price-amount {
  font-size: 48px;
  font-weight: 700;
  color: #667eea;
}

.price-period {
  color: #999;
  font-size: 16px;
}

.plan-features {
  list-style: none;
  margin-bottom: 30px;
}

.plan-features li {
  padding: 12px 0;
  color: #555;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.plan-features li::before {
  content: '‚úì';
  color: #28a745;
  font-weight: 700;
  font-size: 18px;
}

.plan-features li.disabled {
  color: #ccc;
}

.plan-features li.disabled::before {
  content: '‚úó';
  color: #e74c3c;
}

.btn-select-plan {
  width: 100%;
  padding: 15px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-select-plan:hover {
  transform: scale(1.05);
}

.plan-card.selected .btn-select-plan {
  background: #28a745;
}

.btn-continue {
  max-width: 400px;
  margin: 30px auto 0;
  display: block;
  padding: 20px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
}

.btn-continue:hover {
  background: #218838;
}

/* ==================== TELA DE PAGAMENTO ==================== */
.payment-screen {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 20px;
}

.payment-container {
  background: white;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  max-width: 600px;
  width: 100%;
  padding: 40px;
}

.payment-header {
  text-align: center;
  margin-bottom: 30px;
}

.payment-header h1 {
  color: #667eea;
  font-size: 32px;
  margin-bottom: 10px;
}

.payment-header p {
  color: #666;
  font-size: 16px;
}

.payment-plan-info {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 30px;
  text-align: center;
}

.payment-plan-info h2 {
  color: #333;
  font-size: 24px;
  margin-bottom: 10px;
}

.payment-plan-info .price {
  font-size: 48px;
  font-weight: 700;
  color: #667eea;
}

.pix-section {
  border: 2px dashed #667eea;
  padding: 30px;
  border-radius: 10px;
  text-align: center;
  margin-bottom: 20px;
}

.pix-section h3 {
  color: #333;
  margin-bottom: 20px;
  font-size: 20px;
}

#qrcode {
  margin: 20px auto;
  display: inline-block;
}

.pix-key {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 8px;
  margin: 20px 0;
  word-break: break-all;
  font-family: monospace;
  font-size: 14px;
}

.btn-copy-pix {
  background: #28a745;
  color: white;
  border: none;
  padding: 12px 30px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 10px;
}

.btn-copy-pix:hover {
  background: #218838;
}

.payment-instructions {
  background: #fff3cd;
  border-left: 4px solid #ffc107;
  padding: 15px;
  border-radius: 8px;
  margin-top: 20px;
}

.payment-instructions h4 {
  color: #856404;
  margin-bottom: 10px;
}

.payment-instructions ol {
  color: #856404;
  padding-left: 20px;
}

.payment-instructions ol li {
  margin-bottom: 8px;
}

.btn-confirm-payment {
  width: 100%;
  padding: 15px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  margin-top: 20px;
}

.btn-confirm-payment:hover {
  transform: scale(1.02);
}

.btn-skip-payment {
  width: 100%;
  padding: 12px;
  background: #6c757d;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  cursor: pointer;
  margin-top: 10px;
}

/* ==================== SISTEMA PRINCIPAL ==================== */
.main-system {
  width: 100%;
  min-height: 100vh;
  background: #f4f6f9;
}

.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  padding: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.header-content {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 15px;
}

.header h1 {
  font-size: 24px;
}

.user-info-container {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 10px;
}

.user-info {
  text-align: right;
}

.user-name {
  font-weight: 600;
  font-size: 16px;
}

.user-plan {
  font-size: 12px;
  opacity: 0.8;
  margin-top: 5px;
  padding: 4px 12px;
  background: rgba(255,255,255,0.2);
  border-radius: 15px;
  display: inline-block;
}

.user-plan.admin {
  background: #ffd700;
  color: #000;
  font-weight: 700;
}

.header-menu {
  display: flex;
  gap: 10px;
  align-items: center;
}

.btn-header-menu {
  background: rgba(255,255,255,0.2);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.3s;
}

.btn-header-menu:hover {
  background: rgba(255,255,255,0.3);
}

.btn-sair {
  background: #e74c3c;
  color: #fff;
}

.btn-sair:hover {
  background: #c0392b;
}

.cards-container {
  max-width: 1200px;
  margin: 40px auto;
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}

.main-card {
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  text-align: center;
  position: relative;
}

.main-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.main-card.locked {
  opacity: 0.6;
  cursor: not-allowed;
}

.main-card.locked::after {
  content: 'üîí';
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 24px;
}

.main-card .icon {
  font-size: 48px;
  margin-bottom: 15px;
}

.main-card h3 {
  color: #333;
  font-size: 20px;
  margin-bottom: 10px;
}

.main-card p {
  color: #666;
  font-size: 14px;
}

/* ==================== M√ìDULO INDICA√á√ïES ==================== */
.module-container {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  overflow-y: auto;
}

.module-container.active {
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 20px;
}

.module-content {
  background: #fff;
  border-radius: 12px;
  max-width: 1200px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  margin-top: 20px;
}

.module-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  padding: 20px;
  border-radius: 12px 12px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 10;
}

.module-header h2 {
  font-size: 24px;
}

.btn-close {
  background: rgba(255,255,255,0.2);
  border: none;
  color: #fff;
  font-size: 24px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
}

.btn-close:hover {
  background: rgba(255,255,255,0.3);
}

.module-body {
  padding: 20px;
}

.referral-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  border-radius: 15px;
  margin-bottom: 30px;
}

.referral-card h3 {
  font-size: 24px;
  margin-bottom: 20px;
}

.referral-code-box {
  background: rgba(255,255,255,0.2);
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  margin-bottom: 20px;
}

.referral-code {
  font-size: 36px;
  font-weight: 700;
  letter-spacing: 2px;
  margin: 10px 0;
}

.referral-link-box {
  background: white;
  color: #333;
  padding: 15px;
  border-radius: 8px;
  display: flex;
  gap: 10px;
  align-items: center;
}

.referral-link-box input {
  flex: 1;
  padding: 10px;
  border: none;
  background: #f8f9fa;
  border-radius: 6px;
  font-size: 14px;
}

.btn-copy {
  background: #28a745;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
}

.btn-copy:hover {
  background: #218838;
}

.btn-share {
  background: #ffc107;
  color: #000;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
}

.btn-share:hover {
  background: #e0a800;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  padding: 25px;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  text-align: center;
}

.stat-card h4 {
  color: #999;
  font-size: 14px;
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-card .value {
  font-size: 36px;
  font-weight: 700;
  color: #667eea;
}

.referrals-list {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.referrals-list h3 {
  color: #333;
  margin-bottom: 20px;
}

.referral-item {
  padding: 15px;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.referral-item:last-child {
  border-bottom: none;
}

.referral-item-info {
  flex: 1;
}

.referral-item-name {
  font-weight: 600;
  color: #333;
  margin-bottom: 5px;
}

.referral-item-date {
  font-size: 12px;
  color: #999;
}

.referral-item-status {
  padding: 4px 12px;
  border-radius: 15px;
  font-size: 12px;
  font-weight: 600;
}

.status-active {
  background: #d4edda;
  color: #155724;
}

.status-pending {
  background: #fff3cd;
  color: #856404;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #999;
}

.empty-state-icon {
  font-size: 64px;
  margin-bottom: 20px;
}

/* Formul√°rios */
.form-card {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  border: 2px solid #e0e0e0;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 15px;
}

.form-group-inline {
  display: flex;
  flex-direction: column;
}

.form-group-inline label {
  font-weight: 600;
  color: #333;
  margin-bottom: 5px;
  font-size: 13px;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  font-size: 14px;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: #667eea;
}

.action-buttons {
  display: flex;
  gap: 10px;
  margin-top: 15px;
  flex-wrap: wrap;
}

.btn-secondary {
  background: #6c757d;
  color: #fff;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-sync {
  background: #667eea;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
}

.btn-sync:hover {
  background: #5568d3;
}

/* Tabelas */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  background: #fff;
}

table th, table td {
  border: 1px solid #ddd;
  padding: 12px;
  text-align: left;
}

table th {
  background: #f8f9fa;
  font-weight: 600;
  color: #333;
}

table tbody tr:hover {
  background: #f8f9fa;
}

.btn-edit {
  background: #f39c12;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  margin-right: 5px;
}

.btn-edit:hover {
  background: #e67e22;
}

.btn-delete {
  background: #e74c3c;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.btn-delete:hover {
  background: #c0392b;
}

/* Toast */
.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: white;
  padding: 15px 20px;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  z-index: 10000;
  opacity: 0;
  transform: translateY(-20px);
  transition: all 0.3s;
  max-width: 350px;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}

.toast.success {
  border-left: 4px solid #28a745;
}

.toast.error {
  border-left: 4px solid #e74c3c;
}

.toast.warning {
  border-left: 4px solid #ffc107;
}

/* Loading */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 99999;
}

.loading-overlay.show {
  display: flex;
}

.spinner {
  border: 5px solid #f3f3f3;
  border-top: 5px solid #667eea;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@media (max-width: 768px) {
  .header-content {
    flex-direction: column;
    text-align: center;
  }
  
  .user-info-container {
    align-items: center;
  }
  
  .header-menu {
    width: 100%;
    justify-content: center;
  }
  
  .plans-header h1 {
    font-size: 32px;
  }
  
  .plans-grid {
    grid-template-columns: 1fr;
  }
  
  .plan-card.popular {
    transform: scale(1);
  }
  
  .payment-container {
    padding: 20px;
  }
}
</style>
</head>

<body>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- ==================== TELA DE LOGIN ==================== -->
<div class="screen active" id="loginScreen">
  <div class="login-screen">
    <div class="login-container">
      <div class="logo">
        <div class="logo-icon">üí∞</div>
        <h1>Sistema Financeiro</h1>
        <p class="subtitle">Controle suas finan√ßas de forma inteligente</p>
      </div>

      <div class="tabs">
        <div class="tab active" onclick="switchTab('login')">Entrar</div>
        <div class="tab" onclick="switchTab('register')">Criar Conta</div>
      </div>

      <div id="loginMessage" class="message"></div>

      <!-- LOGIN -->
      <div id="loginForm" class="form-section active">
        <form onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="loginEmail">Email</label>
            <input type="email" id="loginEmail" placeholder="seu@email.com" required>
          </div>

          <div class="form-group">
            <label for="loginSenha">Senha</label>
            <input type="password" id="loginSenha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>

          <button type="submit" class="btn-primary" id="btnLogin">Entrar</button>
        </form>
      </div>

      <!-- REGISTRO -->
      <div id="registerForm" class="form-section">
        <form onsubmit="handleRegister(event)">
          <div class="form-group">
            <label for="regNome">Nome Completo</label>
            <input type="text" id="regNome" placeholder="Seu nome" required>
          </div>

          <div class="form-group">
            <label for="regEmail">Email</label>
            <input type="email" id="regEmail" placeholder="seu@email.com" required>
          </div>

          <div class="form-group">
            <label for="regSenha">Senha</label>
            <input type="password" id="regSenha" placeholder="M√≠nimo 6 caracteres" minlength="6" required>
          </div>

          <div class="form-group">
            <label for="regSenhaConfirm">Confirmar Senha</label>
            <input type="password" id="regSenhaConfirm" placeholder="Digite novamente" required>
          </div>

          <button type="submit" class="btn-primary" id="btnRegister">Criar Conta Gr√°tis</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ==================== TELA DE PLANOS ==================== -->
<div class="screen" id="plansScreen">
  <div class="plans-screen">
    <div class="plans-container">
      <div class="plans-header">
        <h1>üí∞ Escolha Seu Plano</h1>
        <p>Selecione o plano ideal para suas necessidades</p>
      </div>

      <div class="plans-grid">
        <!-- GRATUITO -->
        <div class="plan-card" data-plan="gratuito" onclick="selectPlan('gratuito')">
          <div class="plan-name">Gratuito</div>
          <div class="plan-price">
            <span class="price-amount">R$ 0</span>
            <span class="price-period">/m√™s</span>
          </div>
          <ul class="plan-features">
            <li>At√© 50 transa√ß√µes/m√™s</li>
            <li>1 usu√°rio</li>
            <li>M√≥dulo Financeiro</li>
            <li class="disabled">Sem Investimentos</li>
            <li class="disabled">Sem Consigna√ß√£o</li>
            <li class="disabled">Sem Sincroniza√ß√£o</li>
          </ul>
          <button class="btn-select-plan">Selecionar</button>
        </div>

        <!-- B√ÅSICO -->
        <div class="plan-card" data-plan="basico" onclick="selectPlan('basico')">
          <div class="plan-name">B√°sico</div>
          <div class="plan-price">
            <span class="price-amount">R$ 9,90</span>
            <span class="price-period">/m√™s</span>
          </div>
          <ul class="plan-features">
            <li>Transa√ß√µes ilimitadas</li>
            <li>1 usu√°rio</li>
            <li>Financeiro + Investimentos</li>
            <li>Sincroniza√ß√£o Google Sheets</li>
            <li>Exporta√ß√£o CSV/PDF</li>
            <li class="disabled">Sem Consigna√ß√£o</li>
          </ul>
          <button class="btn-select-plan">Selecionar</button>
        </div>

        <!-- PREMIUM -->
        <div class="plan-card popular" data-plan="premium" onclick="selectPlan('premium')">
          <div class="popular-badge">‚≠ê MAIS POPULAR</div>
          <div class="plan-name">Premium</div>
          <div class="plan-price">
            <span class="price-amount">R$ 19,90</span>
            <span class="price-period">/m√™s</span>
          </div>
          <ul class="plan-features">
            <li>Tudo do B√°sico +</li>
            <li>At√© 3 usu√°rios</li>
            <li>Todos os m√≥dulos</li>
            <li>Suporte priorit√°rio</li>
            <li>Backup autom√°tico</li>
            <li>Relat√≥rios avan√ßados</li>
          </ul>
          <button class="btn-select-plan">Selecionar</button>
        </div>

        <!-- EMPRESARIAL -->
        <div class="plan-card" data-plan="empresarial" onclick="selectPlan('empresarial')">
          <div class="plan-name">Empresarial</div>
          <div class="plan-price">
            <span class="price-amount">R$ 49,90</span>
            <span class="price-period">/m√™s</span>
          </div>
          <ul class="plan-features">
            <li>Tudo do Premium +</li>
            <li>Usu√°rios ilimitados</li>
            <li>API de integra√ß√£o</li>
            <li>White label</li>
            <li>Consultoria mensal</li>
            <li>Suporte 24/7</li>
          </ul>
          <button class="btn-select-plan">Selecionar</button>
        </div>
      </div>

      <button class="btn-continue" onclick="continuarParaPagamento()">
        Continuar para Pagamento ‚Üí
      </button>
    </div>
  </div>
</div>

<!-- ==================== TELA DE PAGAMENTO PIX ==================== -->
<div class="screen" id="paymentScreen">
  <div class="payment-screen">
    <div class="payment-container">
      <div class="payment-header">
        <h1>üí≥ Pagamento via PIX</h1>
        <p>Finalize seu pagamento de forma r√°pida e segura</p>
      </div>

      <div class="payment-plan-info">
        <h2 id="paymentPlanName">Plano B√°sico</h2>
        <div class="price" id="paymentPlanPrice">R$ 9,90</div>
        <p style="color: #666; margin-top: 10px;">por m√™s</p>
      </div>

      <div class="pix-section">
        <h3>üî≤ Escaneie o QR Code</h3>
        <div id="qrcode"></div>
        
        <p style="margin: 20px 0; color: #666;">ou copie a chave PIX:</p>
        
        <div class="pix-key" id="pixKey">eebc1520-20d3-465c-98e9-fc012f51d58</div>
        
        <button class="btn-copy-pix" onclick="copyPixKey()">
          üìã Copiar Chave PIX
        </button>
      </div>

      <div class="payment-instructions">
        <h4>üìù Instru√ß√µes:</h4>
        <ol>
          <li>Abra o aplicativo do seu banco</li>
          <li>Escolha a op√ß√£o PIX</li>
          <li>Escaneie o QR Code ou cole a chave PIX</li>
          <li>Confirme o pagamento</li>
          <li>Clique em "J√° Fiz o Pagamento" abaixo</li>
        </ol>
      </div>

      <button class="btn-confirm-payment" onclick="confirmarPagamento()">
        ‚úÖ J√° Fiz o Pagamento
      </button>
      
      <button class="btn-skip-payment" onclick="pularPagamento()">
        Pular por enquanto
      </button>
    </div>
  </div>
</div>

<!-- ==================== SISTEMA PRINCIPAL ==================== -->
<div class="screen" id="mainScreen">
  <div class="main-system">
    <div class="header">
      <div class="header-content">
        <h1>üí∞ Sistema Financeiro Pessoal</h1>
        <div class="user-info-container">
          <div class="user-info">
            <div class="user-name" id="userName">Usu√°rio</div>
            <div class="user-plan" id="userPlanBadge">Plano: Gratuito</div>
          </div>
          <div class="header-menu">
            <button class="btn-header-menu" onclick="abrirIndicacoes()">
              ü§ù Indica√ß√µes
            </button>
            <button class="btn-header-menu btn-sair" onclick="fazerLogout()">
              üö™ Sair
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="cards-container" id="cardsContainer">
      <!-- Cards ser√£o inseridos dinamicamente -->
    </div>
  </div>
</div>

<!-- ==================== M√ìDULO INDICA√á√ïES ==================== -->
<div class="module-container" id="moduleIndicacoes">
  <div class="module-content">
    <div class="module-header">
      <h2>ü§ù Programa de Indica√ß√µes</h2>
      <button class="btn-close" onclick="closeModule('indicacoes')">&times;</button>
    </div>
    <div class="module-body">
      
      <!-- Card de Indica√ß√£o -->
      <div class="referral-card">
        <h3>Seu C√≥digo de Indica√ß√£o</h3>
        <div class="referral-code-box">
          <p>Compartilhe este c√≥digo com seus amigos:</p>
          <div class="referral-code" id="referralCode">CARREGANDO...</div>
        </div>
        
        <div class="referral-link-box">
          <input type="text" id="referralLink" readonly value="Carregando...">
          <button class="btn-copy" onclick="copiarCodigoIndicacao()">Copiar</button>
          <button class="btn-share" onclick="compartilharIndicacao()">Compartilhar</button>
        </div>
      </div>

      <!-- Estat√≠sticas -->
      <div class="stats-grid">
        <div class="stat-card">
          <h4>Total de Indica√ß√µes</h4>
          <div class="value" id="totalIndicacoes">0</div>
        </div>
        
        <div class="stat-card">
          <h4>Indica√ß√µes Ativas</h4>
          <div class="value" id="indicacoesAtivas">0</div>
        </div>
        
        <div class="stat-card">
          <h4>Benef√≠cios Ganhos</h4>
          <div class="value" id="beneficiosGanhos">0</div>
        </div>
      </div>

      <!-- Lista de Indica√ß√µes -->
      <div class="referrals-list">
        <h3>Suas Indica√ß√µes</h3>
        <div id="referralsList">
          <div class="empty-state">
            <div class="empty-state-icon">üéÅ</div>
            <p>Voc√™ ainda n√£o indicou ningu√©m</p>
            <p style="margin-top: 10px; font-size: 14px;">Compartilhe seu c√≥digo e ganhe benef√≠cios!</p>
          </div>
        </div>
      </div>

      <!-- Benef√≠cios -->
      <div style="background: #fff3cd; padding: 20px; border-radius: 10px; border-left: 4px solid #ffc107; margin-top: 30px;">
        <h4 style="color: #856404; margin-bottom: 10px;">üéÅ Como Funciona:</h4>
        <ul style="color: #856404; padding-left: 20px;">
          <li>A cada <strong>3 indica√ß√µes</strong>, voc√™ ganha <strong>1 m√™s gr√°tis</strong>!</li>
          <li>Seus amigos tamb√©m ganham <strong>desconto especial</strong> no primeiro m√™s</li>
          <li>Quanto mais voc√™ indica, mais benef√≠cios acumula</li>
        </ul>
      </div>
      
    </div>
  </div>
</div>

<!-- ==================== M√ìDULO FINANCEIRO ==================== -->
<div class="module-container" id="moduleFinanceiro">
  <div class="module-content">
    <div class="module-header">
      <h2>üí∞ Movimenta√ß√µes Financeiras</h2>
      <button class="btn-close" onclick="closeModule('financeiro')">&times;</button>
    </div>
    <div class="module-body">
      <div class="form-card">
        <h3>Nova Transa√ß√£o</h3>
        <input type="hidden" id="f_id">
        
        <div class="form-grid">
          <div class="form-group-inline">
            <label for="f_data">Data *</label>
            <input type="date" id="f_data" required>
          </div>
          
          <div class="form-group-inline">
            <label for="f_tipo">Tipo *</label>
            <select id="f_tipo" required>
              <option value="Receita">Receita</option>
              <option value="Despesa">Despesa</option>
            </select>
          </div>
          
          <div class="form-group-inline">
            <label for="f_valor">Valor (R$) *</label>
            <input type="number" step="0.01" id="f_valor" placeholder="0,00" required>
          </div>
          
          <div class="form-group-inline">
            <label for="f_desc">Descri√ß√£o *</label>
            <input type="text" id="f_desc" placeholder="Descri√ß√£o" required>
          </div>
          
          <div class="form-group-inline">
            <label for="f_cat">Categoria</label>
            <select id="f_cat">
              <option>Sal√°rio</option>
              <option>Alimenta√ß√£o</option>
              <option>Transporte</option>
              <option>Moradia</option>
              <option>Sa√∫de</option>
              <option>Educa√ß√£o</option>
              <option>Lazer</option>
              <option>Outros</option>
            </select>
          </div>
        </div>
        
        <div class="action-buttons">
          <button class="btn-primary" onclick="saveFinanceiro()">Salvar</button>
          <button class="btn-secondary" onclick="resetFinForm()">Cancelar</button>
          <button class="btn-sync" onclick="syncFinanceiro()">üîÑ Sincronizar</button>
        </div>
      </div>
      
      <div class="data-table">
        <h3>Hist√≥rico</h3>
        <table id="financeiroTable">
          <thead>
            <tr>
              <th>Data</th>
              <th>Tipo</th>
              <th>Descri√ß√£o</th>
              <th>Categoria</th>
              <th>Valor</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
// ==================== CONFIGURA√á√ÉO ====================
const SHEETS_URL = 'https://script.google.com/macros/s/AKfycbwHKLI8gLj8nZiZba4fq_dbnwdGU-DduqndlIOqUJCnzv6gB_-Z7Tweg63rSFBoa_hh/exec';
const ADMIN_EMAIL = 'arnoldlima67@gmail.com';
const PIX_KEY = 'eebc1520-20d3-465c-98e9-fc012f51d58';

// Pre√ßos dos planos
const PRECOS_PLANOS = {
  gratuito: 0,
  basico: 9.90,
  premium: 19.90,
  empresarial: 49.90
};

// Dados locais
let financeiro = [];
let planoSelecionado = null;

// M√≥dulos por plano
const MODULOS_POR_PLANO = {
  gratuito: ['financeiro'],
  basico: ['financeiro', 'investimentos'],
  premium: ['financeiro', 'investimentos', 'consignacao', 'anotacoes', 'vendas'],
  empresarial: ['financeiro', 'investimentos', 'consignacao', 'anotacoes', 'vendas', 'dashboard']
};

const TODOS_MODULOS = {
  financeiro: { icon: 'üí∏', nome: 'Financeiro', desc: 'Controle de receitas e despesas' },
  investimentos: { icon: 'üìà', nome: 'Investimentos', desc: 'Gerencie sua carteira' },
  consignacao: { icon: 'ü§ù', nome: 'Consigna√ß√£o', desc: 'Controle de empr√©stimos' },
  anotacoes: { icon: 'üìù', nome: 'Anota√ß√µes', desc: 'Lembretes importantes' },
  vendas: { icon: 'üõçÔ∏è', nome: 'Vendas', desc: 'Gest√£o de produtos' },
  dashboard: { icon: 'üìä', nome: 'Dashboard', desc: 'Vis√£o geral completa' }
};

// ==================== SISTEMA DE LICEN√áAS ====================
class SistemaLicencas {
  constructor(url) {
    this.SHEETS_URL = url;
  }

  async registrarUsuario(email, senha, nome) {
    try {
      const userId = 'USER_' + Date.now();
      const senhaHash = await this.hashSenha(senha);
      
      const dados = {
        acao: 'registrar',
        userId: userId,
        email: email,
        senha: senhaHash,
        nome: nome,
        plano: 'gratuito',
        dataCriacao: new Date().toISOString(),
        transacoesUsadas: 0,
        status: 'ativo',
        codigoIndicacao: 'REF' + Math.random().toString(36).substr(2, 9).toUpperCase(),
        token: 'TOKEN_' + Date.now()
      };

      const response = await fetch(this.SHEETS_URL, {
        method: 'POST',
        body: JSON.stringify(dados)
      });

      const resultado = await response.json();
      
      if (resultado.sucesso) {
        localStorage.setItem('userId', userId);
        localStorage.setItem('userToken', dados.token);
        localStorage.setItem('userEmail', email);
        localStorage.setItem('userNome', nome);
        localStorage.setItem('userPlano', 'gratuito');
        localStorage.setItem('codigoIndicacao', dados.codigoIndicacao);
        return { sucesso: true };
      }
      
      return { sucesso: false, erro: resultado.mensagem };
    } catch (error) {
      return { sucesso: false, erro: 'Erro ao conectar' };
    }
  }

  async fazerLogin(email, senha) {
    try {
      const senhaHash = await this.hashSenha(senha);
      
      const response = await fetch(this.SHEETS_URL, {
        method: 'POST',
        body: JSON.stringify({
          acao: 'login',
          email: email,
          senha: senhaHash
        })
      });

      const resultado = await response.json();
      
      if (resultado.sucesso) {
        localStorage.setItem('userId', resultado.usuario.userId);
        localStorage.setItem('userToken', resultado.usuario.token);
        localStorage.setItem('userEmail', resultado.usuario.email);
        localStorage.setItem('userNome', resultado.usuario.nome);
        localStorage.setItem('userPlano', resultado.usuario.plano);
        localStorage.setItem('codigoIndicacao', resultado.usuario.codigoIndicacao);
        return { sucesso: true };
      }
      
      return { sucesso: false, erro: 'Email ou senha incorretos' };
    } catch (error) {
      return { sucesso: false, erro: 'Erro ao conectar' };
    }
  }

  async hashSenha(senha) {
    const encoder = new TextEncoder();
    const data = encoder.encode(senha + 'SALT_FIN');
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  }

  verificarLogado() {
    return !!(localStorage.getItem('userId') && localStorage.getItem('userToken'));
  }

  isAdmin() {
    return localStorage.getItem('userEmail') === ADMIN_EMAIL;
  }
}

const sistema = new SistemaLicencas(SHEETS_URL);

// ==================== NAVEGA√á√ÉO ====================
function showScreen(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(screenId).classList.add('active');
}

function showLoading() {
  document.getElementById('loadingOverlay').classList.add('show');
}

function hideLoading() {
  document.getElementById('loadingOverlay').classList.remove('show');
}

function showToast(mensagem, tipo = 'success') {
  const toast = document.getElementById('toast');
  toast.textContent = mensagem;
  toast.className = `toast ${tipo} show`;
  setTimeout(() => toast.classList.remove('show'), 3000);
}

function showMessage(mensagem, tipo = 'success') {
  const msg = document.getElementById('loginMessage');
  msg.textContent = mensagem;
  msg.className = `message ${tipo}`;
  msg.style.display = 'block';
}

// ==================== LOGIN/REGISTRO ====================
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.form-section').forEach(f => f.classList.remove('active'));
  
  if (tab === 'login') {
    document.querySelectorAll('.tab')[0].classList.add('active');
    document.getElementById('loginForm').classList.add('active');
  } else {
    document.querySelectorAll('.tab')[1].classList.add('active');
    document.getElementById('registerForm').classList.add('active');
  }
  
  document.getElementById('loginMessage').style.display = 'none';
}

async function handleLogin(event) {
  event.preventDefault();
  
  const email = document.getElementById('loginEmail').value;
  const senha = document.getElementById('loginSenha').value;
  
  document.getElementById('btnLogin').disabled = true;
  document.getElementById('btnLogin').textContent = 'Entrando...';
  
  const resultado = await sistema.fazerLogin(email, senha);
  
  if (resultado.sucesso) {
    showMessage('‚úÖ Login realizado!', 'success');
    setTimeout(() => showScreen('plansScreen'), 1000);
  } else {
    showMessage('‚ùå ' + resultado.erro, 'error');
    document.getElementById('btnLogin').disabled = false;
    document.getElementById('btnLogin').textContent = 'Entrar';
  }
}

async function handleRegister(event) {
  event.preventDefault();
  
  const nome = document.getElementById('regNome').value;
  const email = document.getElementById('regEmail').value;
  const senha = document.getElementById('regSenha').value;
  const senhaConfirm = document.getElementById('regSenhaConfirm').value;
  
  if (senha !== senhaConfirm) {
    showMessage('‚ùå As senhas n√£o coincidem', 'error');
    return;
  }
  
  document.getElementById('btnRegister').disabled = true;
  document.getElementById('btnRegister').textContent = 'Criando...';
  
  const resultado = await sistema.registrarUsuario(email, senha, nome);
  
  if (resultado.sucesso) {
    showMessage('‚úÖ Conta criada!', 'success');
    setTimeout(() => showScreen('plansScreen'), 1000);
  } else {
    showMessage('‚ùå ' + resultado.erro, 'error');
    document.getElementById('btnRegister').disabled = false;
    document.getElementById('btnRegister').textContent = 'Criar Conta Gr√°tis';
  }
}

// ==================== PLANOS ====================
function selectPlan(plan) {
  document.querySelectorAll('.plan-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  document.querySelector(`[data-plan="${plan}"]`).classList.add('selected');
  planoSelecionado = plan;
  
  showToast(`Plano ${plan.toUpperCase()} selecionado!`, 'success');
}

function continuarParaPagamento() {
  if (!planoSelecionado) {
    showToast('Selecione um plano primeiro!', 'warning');
    return;
  }
  
  // Admin n√£o precisa pagar
  if (sistema.isAdmin()) {
    ativarPlanoAdmin();
    return;
  }
  
  // Plano gratuito n√£o precisa pagar
  if (planoSelecionado === 'gratuito') {
    ativarPlanoGratuito();
    return;
  }
  
  // Mostrar tela de pagamento
  mostrarTelaPagamento();
}

async function ativarPlanoAdmin() {
  showLoading();
  
  const userId = localStorage.getItem('userId');
  
  const response = await fetch(SHEETS_URL, {
    method: 'POST',
    body: JSON.stringify({
      acao: 'atualizarPlano',
      userId: userId,
      novoPlano: 'admin'
    })
  });
  
  localStorage.setItem('userPlano', 'admin');
  hideLoading();
  showToast('Acesso Admin ativado!', 'success');
  setTimeout(() => mostrarSistemaPrincipal(), 1000);
}

async function ativarPlanoGratuito() {
  showLoading();
  
  const userId = localStorage.getItem('userId');
  
  const response = await fetch(SHEETS_URL, {
    method: 'POST',
    body: JSON.stringify({
      acao: 'atualizarPlano',
      userId: userId,
      novoPlano: 'gratuito'
    })
  });
  
  localStorage.setItem('userPlano', 'gratuito');
  hideLoading();
  showToast('Plano Gratuito ativado!', 'success');
  setTimeout(() => mostrarSistemaPrincipal(), 1000);
}

// ==================== PAGAMENTO PIX ====================
function mostrarTelaPagamento() {
  showScreen('paymentScreen');
  
  // Atualizar informa√ß√µes do plano
  const nomes = {
    basico: 'Plano B√°sico',
    premium: 'Plano Premium',
    empresarial: 'Plano Empresarial'
  };
  
  document.getElementById('paymentPlanName').textContent = nomes[planoSelecionado];
  document.getElementById('paymentPlanPrice').textContent = 'R$ ' + PRECOS_PLANOS[planoSelecionado].toFixed(2);
  
  // Gerar QR Code
  document.getElementById('qrcode').innerHTML = '';
  new QRCode(document.getElementById('qrcode'), {
    text: PIX_KEY,
    width: 200,
    height: 200
  });
}

function copyPixKey() {
  navigator.clipboard.writeText(PIX_KEY);
  showToast('‚úÖ Chave PIX copiada!', 'success');
}

async function confirmarPagamento() {
  if (!confirm('Voc√™ j√° realizou o pagamento via PIX?')) {
    return;
  }
  
  showLoading();
  
  try {
    const userId = localStorage.getItem('userId');
    
    // Salvar pagamento pendente
    await fetch(SHEETS_URL, {
      method: 'POST',
      body: JSON.stringify({
        acao: 'criarPagamento',
        pagamentoId: 'PAG_' + Date.now(),
        userId: userId,
        email: localStorage.getItem('userEmail'),
        plano: planoSelecionado,
        periodo: 'mensal',
        valor: PRECOS_PLANOS[planoSelecionado],
        status: 'pendente'
      })
    });
    
    hideLoading();
    showToast('Pagamento em an√°lise! Voc√™ receber√° confirma√ß√£o em breve.', 'success');
    setTimeout(() => mostrarSistemaPrincipal(), 2000);
  } catch (error) {
    hideLoading();
    showToast('Erro ao processar', 'error');
  }
}

function pularPagamento() {
  showToast('Voc√™ pode fazer o pagamento depois nas configura√ß√µes', 'warning');
  setTimeout(() => mostrarSistemaPrincipal(), 1500);
}

// ==================== SISTEMA PRINCIPAL ====================
function mostrarSistemaPrincipal() {
  showScreen('mainScreen');
  
  const nome = localStorage.getItem('userNome');
  let plano = localStorage.getItem('userPlano') || 'gratuito';
  
  if (sistema.isAdmin()) {
    plano = 'admin';
    localStorage.setItem('userPlano', 'admin');
  }
  
  document.getElementById('userName').textContent = 'Ol√°, ' + nome + '!';
  
  const badge = document.getElementById('userPlanBadge');
  badge.textContent = 'Plano: ' + (plano === 'admin' ? 'ADMIN' : plano.toUpperCase());
  
  if (plano === 'admin') {
    badge.classList.add('admin');
  }
  
  renderCards(plano);
  loadFinanceiro();
}

function renderCards(plano) {
  const container = document.getElementById('cardsContainer');
  container.innerHTML = '';
  
  const modulosPermitidos = plano === 'admin' ? Object.keys(TODOS_MODULOS) : MODULOS_POR_PLANO[plano];
  
  Object.keys(TODOS_MODULOS).forEach(key => {
    const mod = TODOS_MODULOS[key];
    const temAcesso = modulosPermitidos.includes(key);
    
    const card = document.createElement('div');
    card.className = 'main-card' + (temAcesso ? '' : ' locked');
    card.onclick = temAcesso ? () => openModule(key) : () => showToast('Fa√ßa upgrade para acessar!', 'warning');
    
    card.innerHTML = `
      <div class="icon">${mod.icon}</div>
      <h3>${mod.nome}</h3>
      <p>${mod.desc}</p>
    `;
    
    container.appendChild(card);
  });
}

function openModule(module) {
  if (module === 'financeiro') {
    document.getElementById('moduleFinanceiro').classList.add('active');
    renderFinanceiro();
  }
}

function closeModule(module) {
  if (module === 'indicacoes') {
    document.getElementById('moduleIndicacoes').classList.remove('active');
  } else {
    document.getElementById('module' + module.charAt(0).toUpperCase() + module.slice(1)).classList.remove('active');
  }
}

function fazerLogout() {
  if (confirm('Deseja sair?')) {
    localStorage.clear();
    location.reload();
  }
}

// ==================== INDICA√á√ïES ====================
async function abrirIndicacoes() {
  document.getElementById('moduleIndicacoes').classList.add('active');
  
  const codigo = localStorage.getItem('codigoIndicacao');
  document.getElementById('referralCode').textContent = codigo;
  
  const link = `${window.location.origin}${window.location.pathname}?ref=${codigo}`;
  document.getElementById('referralLink').value = link;
  
  // Carregar indica√ß√µes do usu√°rio
  await carregarIndicacoes();
}

async function carregarIndicacoes() {
  try {
    const userId = localStorage.getItem('userId');
    
    const response = await fetch(SHEETS_URL, {
      method: 'POST',
      body: JSON.stringify({
        acao: 'obterIndicacoes',
        userId: userId
      })
    });
    
    const resultado = await response.json();
    
    if (resultado.sucesso && resultado.indicacoes) {
      const indicacoes = resultado.indicacoes;
      
      document.getElementById('totalIndicacoes').textContent = indicacoes.length;
      document.getElementById('indicacoesAtivas').textContent = indicacoes.filter(i => i.status === 'ativo').length;
      document.getElementById('beneficiosGanhos').textContent = Math.floor(indicacoes.length / 3);
      
      const lista = document.getElementById('referralsList');
      
      if (indicacoes.length === 0) {
        lista.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üéÅ</div>
            <p>Voc√™ ainda n√£o indicou ningu√©m</p>
            <p style="margin-top: 10px; font-size: 14px;">Compartilhe seu c√≥digo e ganhe benef√≠cios!</p>
          </div>
        `;
      } else {
        lista.innerHTML = indicacoes.map(ind => `
          <div class="referral-item">
            <div class="referral-item-info">
              <div class="referral-item-name">Indica√ß√£o #${ind.id}</div>
              <div class="referral-item-date">${new Date(ind.data).toLocaleDateString('pt-BR')}</div>
            </div>
            <span class="referral-item-status status-active">Ativo</span>
          </div>
        `).join('');
      }
    }
  } catch (error) {
    console.error('Erro ao carregar indica√ß√µes:', error);
  }
}

function copiarCodigoIndicacao() {
  const codigo = document.getElementById('referralCode').textContent;
  navigator.clipboard.writeText(codigo);
  showToast('‚úÖ C√≥digo copiado!', 'success');
}

function compartilharIndicacao() {
  const link = document.getElementById('referralLink').value;
  const texto = `Ol√°! Estou usando este sistema financeiro incr√≠vel e quero te indicar! Use meu c√≥digo para ganhar desconto: ${link}`;
  
  if (navigator.share) {
    navigator.share({
      title: 'Sistema Financeiro',
      text: texto,
      url: link
    });
  } else {
    navigator.clipboard.writeText(link);
    showToast('‚úÖ Link copiado! Cole onde quiser compartilhar.', 'success');
  }
}

// ==================== FINANCEIRO COM SINCRONIZA√á√ÉO ====================
async function loadFinanceiro() {
  showLoading();
  
  try {
    const userId = localStorage.getItem('userId');
    
    const response = await fetch(SHEETS_URL, {
      method: 'POST',
      body: JSON.stringify({
        acao: 'carregar',
        aba: 'financeiro',
        userId: userId
      })
    });
    
    const resultado = await response.json();
    
    if (resultado.sucesso && resultado.dados) {
      financeiro = resultado.dados;
      renderFinanceiro();
    }
  } catch (error) {
    console.error('Erro ao carregar:', error);
  } finally {
    hideLoading();
  }
}

async function saveFinanceiro() {
  const id = document.getElementById('f_id').value;
  
  const item = {
    id: id || Date.now(),
    data: document.getElementById('f_data').value,
    tipo: document.getElementById('f_tipo').value,
    valor: parseFloat(document.getElementById('f_valor').value),
    descricao: document.getElementById('f_desc').value,
    categoria: document.getElementById('f_cat').value
  };
  
  if (!item.data || !item.descricao) {
    showToast('Preencha todos os campos!', 'error');
    return;
  }
  
  showLoading();
  
  try {
    const userId = localStorage.getItem('userId');
    
    const response = await fetch(SHEETS_URL, {
      method: 'POST',
      body: JSON.stringify({
        acao: 'salvar',
        aba: 'financeiro',
        userId: userId,
        dados: item
      })
    });
    
    const resultado = await response.json();
    
    if (resultado.sucesso) {
      showToast('‚úÖ Salvo com sucesso!', 'success');
      await loadFinanceiro();
      resetFinForm();
    }
  } catch (error) {
    showToast('Erro ao salvar', 'error');
  } finally {
    hideLoading();
  }
}

async function deleteFinanceiro(id) {
  if (!confirm('Excluir esta transa√ß√£o?')) return;
  
  showLoading();
  
  try {
    const userId = localStorage.getItem('userId');
    
    const response = await fetch(SHEETS_URL, {
      method: 'POST',
      body: JSON.stringify({
        acao: 'deletar',
        aba: 'financeiro',
        userId: userId,
        id: id
      })
    });
    
    const resultado = await response.json();
    
    if (resultado.sucesso) {
      showToast('‚úÖ Exclu√≠do!', 'success');
      await loadFinanceiro();
    }
  } catch (error) {
    showToast('Erro ao excluir', 'error');
  } finally {
    hideLoading();
  }
}

function editFinanceiro(id) {
  const item = financeiro.find(f => f.id == id);
  
  document.getElementById('f_id').value = item.id;
  document.getElementById('f_data').value = item.data;
  document.getElementById('f_tipo').value = item.tipo;
  document.getElementById('f_valor').value = item.valor;
  document.getElementById('f_desc').value = item.descricao;
  document.getElementById('f_cat').value = item.categoria;
  
  document.querySelector('#moduleFinanceiro .form-card').scrollIntoView({behavior: 'smooth'});
}

function renderFinanceiro() {
  const tbody = document.querySelector('#financeiroTable tbody');
  tbody.innerHTML = '';
  
  financeiro.forEach(item => {
    const row = tbody.insertRow();
    row.innerHTML = `
      <td>${new Date(item.data).toLocaleDateString('pt-BR')}</td>
      <td><span style="color: ${item.tipo === 'Receita' ? 'green' : 'red'}">${item.tipo}</span></td>
      <td>${item.descricao}</td>
      <td>${item.categoria}</td>
      <td>R$ ${item.valor.toFixed(2)}</td>
      <td>
        <button class="btn-edit" onclick="editFinanceiro(${item.id})">Editar</button>
        <button class="btn-delete" onclick="deleteFinanceiro(${item.id})">Excluir</button>
      </td>
    `;
  });
}

function resetFinForm() {
  document.getElementById('f_id').value = '';
  document.getElementById('f_data').value = '';
  document.getElementById('f_valor').value = '';
  document.getElementById('f_desc').value = '';
  document.getElementById('f_cat').selectedIndex = 0;
}

async function syncFinanceiro() {
  showToast('Sincronizando...', 'success');
  await loadFinanceiro();
}

// ==================== INICIALIZA√á√ÉO ====================
window.onload = function() {
  if (sistema.verificarLogado()) {
    const temPlano = localStorage.getItem('userPlano');
    if (!temPlano || temPlano === 'null') {
      showScreen('plansScreen');
    } else {
      mostrarSistemaPrincipal();
    }
  }
  
  document.getElementById('f_data').valueAsDate = new Date();
};
</script>

</body>
</html>
