<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema Financeiro Pessoal - Vers√£o Completa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* CONFIGURA√á√ÉO */
.config-section {
  background: #fff3cd;
  border: 2px solid #ffc107;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
}

.config-section h3 {
  color: #856404;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.config-section input {
  width: 100%;
  padding: 10px;
  border: 2px solid #ffc107;
  border-radius: 6px;
  font-size: 13px;
  font-family: monospace;
}

.config-section button {
  margin-top: 10px;
  background: #ffc107;
  color: #000;
  font-weight: 600;
}

.config-section button:hover {
  background: #e0a800;
}

.config-section small {
  display: block;
  margin-top: 8px;
  color: #856404;
  font-size: 12px;
}

/* TELA DE LOGIN */
.login-container {
  background: #fff;
  padding: 40px;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  width: 90%;
  max-width: 400px;
}

.login-container h2 {
  text-align: center;
  color: #667eea;
  margin-bottom: 30px;
  font-size: 28px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: #333;
  font-weight: 600;
}

.form-group input {
  width: 100%;
  padding: 12px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 14px;
  transition: border-color 0.3s;
}

.form-group input:focus {
  outline: none;
  border-color: #667eea;
}

.btn-entrar {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s;
}

.btn-entrar:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

/* TELA PRINCIPAL */
.main-container {
  display: none;
  width: 100%;
  min-height: 100vh;
  background: #f4f6f9;
}

.main-container.active {
  display: block;
}

.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  padding: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.header-content {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header h1 {
  font-size: 24px;
}

.user-info {
  text-align: right;
}

.user-name {
  font-weight: 600;
  font-size: 16px;
}

.btn-sair {
  background: rgba(255,255,255,0.2);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 5px;
  font-size: 14px;
}

.btn-sair:hover {
  background: rgba(255,255,255,0.3);
}

/* CARDS PRINCIPAIS */
.cards-container {
  max-width: 1200px;
  margin: 40px auto;
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}

.main-card {
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  text-align: center;
}

.main-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.main-card .icon {
  font-size: 48px;
  margin-bottom: 15px;
}

.main-card h3 {
  color: #333;
  font-size: 20px;
  margin-bottom: 10px;
}

.main-card p {
  color: #666;
  font-size: 14px;
}

/* TELA DE M√ìDULO */
.module-container {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  overflow-y: auto;
}

.module-container.active {
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 20px;
}

.module-content {
  background: #fff;
  border-radius: 12px;
  max-width: 1200px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  margin-top: 20px;
}

.module-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  padding: 20px;
  border-radius: 12px 12px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 10;
}

.module-header h2 {
  font-size: 24px;
}

.btn-close {
  background: rgba(255,255,255,0.2);
  border: none;
  color: #fff;
  font-size: 24px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-close:hover {
  background: rgba(255,255,255,0.3);
}

.module-body {
  padding: 20px;
}

/* RESUMOS POR CATEGORIA */
.summary-section {
  margin-bottom: 30px;
}

.summary-section h3 {
  color: #333;
  margin-bottom: 15px;
  font-size: 18px;
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 15px;
}

.summary-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.summary-card h4 {
  font-size: 14px;
  margin-bottom: 10px;
  opacity: 0.9;
  font-weight: 600;
}

.summary-card p {
  font-size: 24px;
  font-weight: 700;
}

.summary-card.highlight {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.summary-card.danger {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
}

.summary-card.warning {
  background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
}

.recurrence-info {
  background: rgba(255,255,255,0.2);
  padding: 8px;
  border-radius: 4px;
  margin-top: 10px;
  font-size: 11px;
  font-style: italic;
}

/* FORMUL√ÅRIOS */
.form-card {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  border: 2px solid #e0e0e0;
  transition: all 0.3s;
}

.form-card.editing {
  border-color: #667eea;
  background: #f0f4ff;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
}

.form-card h3 {
  color: #333;
  margin-bottom: 15px;
  font-size: 18px;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 15px;
}

.form-group-inline {
  display: flex;
  flex-direction: column;
}

.form-group-inline label {
  font-weight: 600;
  color: #333;
  margin-bottom: 5px;
  font-size: 13px;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  font-size: 14px;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: #667eea;
}

.action-buttons {
  display: flex;
  gap: 10px;
  margin-top: 15px;
  flex-wrap: wrap;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
}

.btn-primary:hover {
  opacity: 0.9;
  transform: translateY(-1px);
}

.btn-secondary {
  background: #6c757d;
  color: #fff;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-export {
  background: #17a2b8;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
}

.btn-export:hover {
  background: #138496;
}

.btn-success {
  background: #28a745;
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 600;
}

.btn-success:hover {
  background: #218838;
}

/* TABELAS */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  background: #fff;
}

table th, table td {
  border: 1px solid #ddd;
  padding: 12px;
  text-align: left;
}

table th {
  background: #f8f9fa;
  font-weight: 600;
  color: #333;
  cursor: pointer;
  user-select: none;
  position: relative;
  padding-right: 25px;
}

table th:hover {
  background: #e9ecef;
}

table th.sortable::after {
  content: '‚áÖ';
  position: absolute;
  right: 8px;
  opacity: 0.3;
  font-size: 12px;
}

table th.sorted-asc::after {
  content: '‚Üë';
  opacity: 1;
  color: #667eea;
}

table th.sorted-desc::after {
  content: '‚Üì';
  opacity: 1;
  color: #667eea;
}

table tbody tr:hover {
  background: #f8f9fa;
}

.btn-edit {
  background: #f39c12;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  margin-right: 5px;
}

.btn-edit:hover {
  background: #e67e22;
}

.btn-delete {
  background: #e74c3c;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.btn-delete:hover {
  background: #c0392b;
}

/* DASHBOARD */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.dashboard-card {
  background: #fff;
  padding: 25px;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  text-align: center;
  border-left: 4px solid #667eea;
}

.dashboard-card h3 {
  color: #666;
  font-size: 14px;
  margin-bottom: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.dashboard-card p {
  font-size: 28px;
  font-weight: 700;
  color: #764ba2;
}

.dashboard-card small {
  display: block;
  margin-top: 8px;
  font-size: 12px;
  color: #999;
}

/* ALERTAS E NOTIFICA√á√ïES */
.alert {
  padding: 12px 16px;
  border-radius: 6px;
  margin-bottom: 15px;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.alert-info {
  background: #d1ecf1;
  color: #0c5460;
  border-left: 4px solid #17a2b8;
}

.alert-warning {
  background: #fff3cd;
  color: #856404;
  border-left: 4px solid #ffc107;
}

.alert-success {
  background: #d4edda;
  color: #155724;
  border-left: 4px solid #28a745;
}

/* FILTROS */
.filter-section {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  border: 1px solid #e0e0e0;
}

.filter-section h3 {
  color: #667eea;
  margin-bottom: 15px;
  font-size: 18px;
}

.filter-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 15px;
}

.filter-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}

/* STATUS BADGES */
.status-pago {
  background: #28a745;
  color: #fff;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 600;
}

.status-aberto {
  background: #f39c12;
  color: #fff;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 600;
}

.status-atrasado {
  background: #e74c3c;
  color: #fff;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 600;
}

/* GR√ÅFICO */
.chart-container {
  position: relative;
  height: 300px;
  margin-top: 20px;
}

/* RESPONSIVIDADE */
@media (max-width: 768px) {
  .header-content {
    flex-direction: column;
    text-align: center;
  }
  
  .user-info {
    text-align: center;
    margin-top: 15px;
  }
  
  .filter-grid, .form-grid {
    grid-template-columns: 1fr;
  }
  
  .summary-grid {
    grid-template-columns: 1fr;
  }
  
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .action-buttons button {
    width: 100%;
  }
}

/* LOADING */
.loading {
  display: none;
  text-align: center;
  padding: 20px;
  color: #667eea;
}

.loading.show {
  display: block;
}

/* SINCRONIZA√á√ÉO */
.sync-status {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #fff;
  padding: 15px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 9999;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s;
}

.sync-status.show {
  opacity: 1;
  transform: translateY(0);
}

.sync-status.success {
  border-left: 4px solid #28a745;
}

.sync-status.error {
  border-left: 4px solid #e74c3c;
}

.sync-status.syncing {
  border-left: 4px solid #667eea;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 3px solid #f3f3f3;
  border-top: 3px solid #667eea;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.btn-sync {
  background: #667eea;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-sync:hover {
  background: #5568d3;
}

.btn-load {
  background: #28a745;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-load:hover {
  background: #218838;
}
</style>
</head>

<body>

<!-- TELA DE LOGIN -->
<div class="login-container" id="loginScreen">
  <h2>üí∞ Sistema Financeiro</h2>
  
  <form onsubmit="fazerLogin(event)">
    <div class="form-group">
      <label for="loginNome">Nome Completo <span style="color: red;">*</span></label>
      <input type="text" id="loginNome" required>
    </div>
    
    <div class="form-group">
      <label for="loginEmail">E-mail (opcional)</label>
      <input type="email" id="loginEmail" placeholder="seu@email.com">
    </div>
    
    <button type="submit" class="btn-entrar">Entrar no Sistema</button>
  </form>
</div>

<!-- TELA PRINCIPAL -->
<div class="main-container" id="mainScreen">
  <div class="header">
    <div class="header-content">
      <h1>üí∞ Sistema Financeiro Pessoal</h1>
      <div class="user-info">
        <div class="user-name" id="userName"></div>
        <button class="btn-sair" onclick="fazerLogout()">Sair</button>
      </div>
    </div>
  </div>
  
  <!-- BOT√ÉO DE SINCRONIZA√á√ÉO GERAL -->
<div style="max-width: 1200px; margin: 0 auto 40px; padding: 0 20px;">
  <button onclick="syncAllToSheets()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);">
    üîÑ Sincronizar TODOS os Dados com Google Sheets
  </button>
  
  <button onclick="loadAllFromSheets()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); margin-top: 10px;">
    üì• Carregar TODOS os Dados do Google Sheets
  </button>
</div>
  
  <div class="cards-container">
    <div class="main-card" onclick="openModule('financeiro')">
      <div class="icon">üí∏</div>
      <h3>Financeiro</h3>
      <p>Controle suas receitas e despesas</p>
    </div>
    
    <div class="main-card" onclick="openModule('investimento')">
      <div class="icon">üìà</div>
      <h3>Investimentos</h3>
      <p>Gerencie sua carteira</p>
    </div>
    
    <div class="main-card" onclick="openModule('consignacao')">
      <div class="icon">ü§ù</div>
      <h3>Consigna√ß√£o</h3>
      <p>Controle de empr√©stimos</p>
    </div>
    
    <div class="main-card" onclick="openModule('anotacoes')">
      <div class="icon">üìù</div>
      <h3>Anota√ß√µes</h3>
      <p>Lembretes e observa√ß√µes</p>
    </div>
    
    <div class="main-card" onclick="openModule('vendas')">
      <div class="icon">üõçÔ∏è</div>
      <h3>Vendas</h3>
      <p>Gest√£o de produtos e servi√ßos</p>
    </div>
    
    <div class="main-card" onclick="openModule('dashboard')">
      <div class="icon">üìä</div>
      <h3>Dashboard</h3>
      <p>Vis√£o geral financeira</p>
    </div>
    
    <div class="main-card" onclick="openModule('configuracao')">
      <div class="icon">‚öôÔ∏è</div>
      <h3>Configura√ß√µes</h3>
      <p>Configurar sincroniza√ß√£o</p>
    </div>
  </div>
</div>

<!-- M√ìDULO CONFIGURA√á√ÉO -->
<div class="module-container" id="moduleConfiguracao">
  <div class="module-content">
    <div class="module-header">
      <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>
      <button class="btn-close" onclick="closeModule('configuracao')">&times;</button>
    </div>
    <div class="module-body">
      
      <div class="config-section">
        <h3>üîó URL do Google Apps Script</h3>
        <p style="margin-bottom: 10px;">Cole aqui a URL do seu Google Apps Script para habilitar a sincroniza√ß√£o com o Google Sheets.</p>
        <input type="text" id="sheetsUrlInput" placeholder="https://script.google.com/macros/s/SEU_ID/exec">
        <button class="btn-primary" onclick="salvarSheetsUrl()">Salvar URL</button>
        <small>
          <strong>Status atual:</strong> <span id="urlStatus">N√£o configurado</span>
        </small>
      </div>
      
      <div class="alert alert-info">
        <span>‚ÑπÔ∏è</span>
        <div>
          <strong>Como configurar:</strong>
          <ol style="margin: 8px 0 0 20px; line-height: 1.6;">
            <li>Abra o Google Sheets e crie uma nova planilha</li>
            <li>V√° em <strong>Extens√µes > Apps Script</strong></li>
            <li>Cole o c√≥digo fornecido no arquivo "codigo-google-apps-script.js"</li>
            <li>Clique em <strong>Implantar > Nova implanta√ß√£o</strong></li>
            <li>Selecione tipo: <strong>Aplicativo da Web</strong></li>
            <li>Configurar: <strong>Quem tem acesso: Qualquer pessoa</strong></li>
            <li>Copie a URL gerada e cole acima</li>
          </ol>
        </div>
      </div>
      
    </div>
  </div>
</div>

<!-- M√ìDULO FINANCEIRO -->
<div class="module-container" id="moduleFinanceiro">
  <div class="module-content">
    <div class="module-header">
      <h2>üí∞ Movimenta√ß√µes Financeiras</h2>
      <button class="btn-close" onclick="closeModule('financeiro')">&times;</button>
    </div>
    <div class="module-body">
      
      <!-- RESUMO POR CATEGORIA -->
      <div class="summary-section">
        <h3>Resumo por Categoria (Com Recorr√™ncias Calculadas)</h3>
        <div class="summary-grid" id="financeiroCategorySummary"></div>
      </div>
      
      <!-- FORMUL√ÅRIO -->
      <div class="form-card" id="formFinanceiro">
        <h3 id="finFormTitle">Nova Transa√ß√£o</h3>
        <input type="hidden" id="f_id">
        
        <div class="form-grid">
          <div class="form-group-inline">
            <label for="f_data">Data e Hora *</label>
            <input type="datetime-local" id="f_data" required>
          </div>
          
          <div class="form-group-inline">
            <label for="f_tipo">Tipo *</label>
            <select id="f_tipo" required>
              <option value="Recebido">Receita (Recebido)</option>
              <option value="Pago">Despesa (Pago)</option>
              <option value="Pagar">Despesa (A Pagar)</option>
              <option value="A Receber">Receita (A Receber)</option>
            </select>
          </div>
          
          <div class="form-group-inline">
            <label for="f_valor">Valor (R$) *</label>
            <input type="text" id="f_valor" placeholder="0,00" required>
          </div>
          
          <div class="form-group-inline">
            <label for="f_desc">Descri√ß√£o *</label>
            <input type="text" id="f_desc" placeholder="Descri√ß√£o da transa√ß√£o" required>
          </div>
          
          <div class="form-group-inline">
            <label for="f_cat">Categoria</label>
            <select id="f_cat">
              <option>Sal√°rio</option>
              <option>Alimenta√ß√£o</option>
              <option>Transporte</option>
              <option>Moradia</option>
              <option>Sa√∫de</option>
              <option>Educa√ß√£o</option>
              <option>Lazer</option>
              <option>Investimentos</option>
              <option>Outros</option>
            </select>
          </div>
          
          <div class="form-group-inline">
            <label for="f_rec">Recorr√™ncia</label>
            <select id="f_rec">
              <option>N√£o</option>
              <option>Di√°rio</option>
              <option>Mensal</option>
              <option>Bimestral</option>
              <option>Trimestral</option>
              <option>Semestral</option>
              <option>Anual</option>
            </select>
          </div>
        </div>
        
        <div class="action-buttons">
          <button class="btn-primary" id="btnSaveFin" onclick="saveFinanceiro()">Adicionar Transa√ß√£o</button>
          <button class="btn-secondary" id="btnCancelFin" onclick="resetFinForm()" style="display:none">Cancelar</button>
          <button class="btn-sync" onclick="syncToSheets('financeiro')">
            <span>üîÑ</span>
            <span>Enviar para Sheets</span>
          </button>
          <button class="btn-load" onclick="loadFromSheets('financeiro')">
            <span>üì•</span>
            <span>Carregar do Sheets</span>
          </button>
          <button class="btn-export" onclick="exportToCSV('financeiro')">Exportar CSV</button>
        </div>
      </div>
      
     <!-- FILTROS MELHORADOS -->
<div class="filter-section">
  <h3>üîç Filtros Avan√ßados</h3>
  
  <!-- FILTROS R√ÅPIDOS -->
  <div style="margin-bottom: 15px;">
    <label style="font-weight: 600; color: #333; margin-bottom: 8px; display: block;">Filtros R√°pidos:</label>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
      <button class="btn-primary" onclick="filtrarHoje('financeiro')" style="padding: 8px 16px;">üìÖ Hoje</button>
      <button class="btn-primary" onclick="filtrarSemana('financeiro')" style="padding: 8px 16px;">üìÜ Esta Semana</button>
      <button class="btn-primary" onclick="filtrarMes('financeiro')" style="padding: 8px 16px;">üìä Este M√™s</button>
      <button class="btn-secondary" onclick="mostrarTodos('financeiro')" style="padding: 8px 16px;">üëÅÔ∏è Mostrar Todos</button>
    </div>
  </div>
  
  <!-- BUSCA POR TEXTO -->
  <div style="margin-bottom: 15px;">
    <label style="font-weight: 600; color: #333; margin-bottom: 8px; display: block;">üîç Buscar:</label>
    <input type="text" id="searchFinanceiro" placeholder="Digite para buscar (descri√ß√£o, categoria, valor...)" 
           style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 6px;" 
           oninput="buscarFinanceiro()">
  </div>
  
  <!-- FILTROS PERSONALIZADOS -->
  <div class="filter-grid">
    <div class="form-group-inline">
      <label for="filterFinDataInicio">Data In√≠cio</label>
      <input type="date" id="filterFinDataInicio">
    </div>
    <div class="form-group-inline">
      <label for="filterFinDataFim">Data Fim</label>
      <input type="date" id="filterFinDataFim">
    </div>
    <div class="form-group-inline">
      <label for="filterFinTipo">Tipo</label>
      <select id="filterFinTipo">
        <option value="">Todos</option>
        <option value="Recebido">Recebido</option>
        <option value="Pago">Pago</option>
        <option value="Pagar">A Pagar</option>
        <option value="A Receber">A Receber</option>
      </select>
    </div>
    <div class="form-group-inline">
      <label for="filterFinCategoria">Categoria</label>
      <select id="filterFinCategoria">
        <option value="">Todas</option>
        <option value="Sal√°rio">Sal√°rio</option>
        <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
        <option value="Transporte">Transporte</option>
        <option value="Moradia">Moradia</option>
        <option value="Sa√∫de">Sa√∫de</option>
        <option value="Educa√ß√£o">Educa√ß√£o</option>
        <option value="Lazer">Lazer</option>
        <option value="Investimentos">Investimentos</option>
        <option value="Outros">Outros</option>
      </select>
    </div>
  </div>
  <div class="filter-actions">
    <button class="btn-primary" onclick="applyFinanceiroFilters()">Aplicar Filtros</button>
    <button class="btn-secondary" onclick="clearFinanceiroFilters()">Limpar Tudo</button>
  </div>
</div>
      <!-- TABELA -->
      <div class="data-table">
        <h3>Hist√≥rico de Transa√ß√µes</h3>
        <table id="financeiroTable">
          <thead>
            <tr>
              <th class="sortable" onclick="sortTable('financeiroTable', 0)">Data</th>
              <th class="sortable" onclick="sortTable('financeiroTable', 1)">Tipo</th>
              <th class="sortable" onclick="sortTable('financeiroTable', 2)">Descri√ß√£o</th>
              <th class="sortable" onclick="sortTable('financeiroTable', 3)">Categoria</th>
              <th class="sortable" onclick="sortTable('financeiroTable', 4)">Valor</th>
              <th>Recorr√™ncia</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- (Resto dos m√≥dulos continuam iguais ao original - Investimentos, Consigna√ß√£o, Anota√ß√µes, Vendas, Dashboard) -->
<!-- Por brevidade, n√£o vou repetir todo o c√≥digo HTML, mas os m√≥dulos restantes devem ser inclu√≠dos aqui -->

<!-- M√ìDULO INVESTIMENTOS -->
<div class="module-container" id="moduleInvestimento">
  <div class="module-content">
    <div class="module-header">
      <h2>üìà Carteira de Investimentos</h2>
      <button class="btn-close" onclick="closeModule('investimento')">&times;</button>
    </div>
    <div class="module-body">
      
      <div class="summary-section">
        <h3>Resumo por Modalidade (Com Recorr√™ncias Calculadas)</h3>
        <div class="summary-grid" id="investimentoModalitySummary"></div>
      </div>
      
      <div class="form-card" id="formInvest">
        <h3 id="invFormTitle">Novo Investimento</h3>
        <input type="hidden" id="i_id">
        
<!-- FILTROS INVESTIMENTOS -->
<div class="filter-section">
  <h3>üîç Filtros e Busca</h3>
  
  <!-- BUSCA -->
  <div style="margin-bottom: 15px;">
    <label style="font-weight: 600; color: #333; margin-bottom: 8px; display: block;">üîç Buscar:</label>
    <input type="text" id="searchInvestimentos" placeholder="Digite para buscar (ativo, modalidade...)" 
           style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 6px;" 
           oninput="buscarInvestimentos()">
  </div>
  
  <!-- FILTROS -->
  <div class="filter-grid">
    <div class="form-group-inline">
      <label for="filterInvModalidade">Modalidade</label>
      <select id="filterInvModalidade" onchange="filtrarInvestimentos()">
        <option value="">Todas</option>
        <option value="A√ß√µes">A√ß√µes</option>
        <option value="FIIs">FIIs</option>
        <option value="Renda Fixa">Renda Fixa</option>
        <option value="CDB">CDB</option>
        <option value="Tesouro Direto">Tesouro Direto</option>
        <option value="Criptomoedas">Criptomoedas</option>
        <option value="Fundos">Fundos</option>
        <option value="Outros">Outros</option>
      </select>
    </div>
  </div>
  
  <button class="btn-secondary" onclick="limparFiltrosInvestimentos()" style="margin-top: 10px;">Limpar Filtros</button>
</div>
        
        <div class="form-grid">
          <div class="form-group-inline">
            <label for="i_ativo">Ativo/C√≥digo *</label>
            <input type="text" id="i_ativo" placeholder="Ex: PETR4, HGLG11" required>
          </div>
          
          <div class="form-group-inline">
            <label for="i_mod">Modalidade *</label>
            <select id="i_mod" required>
              <option>A√ß√µes</option>
              <option>FIIs</option>
              <option>Renda Fixa</option>
              <option>CDB</option>
              <option>Tesouro Direto</option>
              <option>Criptomoedas</option>
              <option>Fundos</option>
              <option>Outros</option>
            </select>
          </div>
          
          <div class="form-group-inline">
            <label for="i_data">Data da Compra</label>
            <input type="date" id="i_data">
          </div>
          
          <div class="form-group-inline">
            <label for="i_valor">Valor Investido (R$) *</label>
            <input type="text" id="i_valor" placeholder="0,00" required>
          </div>
          
          <div class="form-group-inline">
            <label for="i_qtd">Quantidade</label>
            <input type="number" id="i_qtd" step="0.01" placeholder="0">
          </div>
          
          <div class="form-group-inline">
            <label for="i_prov">Provento (R$)</label>
            <input type="text" id="i_prov" placeholder="0,00">
          </div>
          
          <div class="form-group-inline">
            <label for="i_rec">Recorr√™ncia de Proventos</label>
            <select id="i_rec">
              <option>N√£o</option>
              <option>Di√°rio</option>
              <option>Mensal</option>
              <option>Bimestral</option>
              <option>Trimestral</option>
              <option>Semestral</option>
              <option>Anual</option>
            </select>
          </div>
        </div>
        
        <div class="action-buttons">
          <button class="btn-primary" id="btnSaveInv" onclick="saveInvestimento()">Adicionar Investimento</button>
          <button class="btn-secondary" id="btnCancelInv" onclick="resetInvForm()" style="display:none">Cancelar</button>
          <button class="btn-sync" onclick="syncToSheets('investimentos')">
            <span>üîÑ</span>
            <span>Enviar para Sheets</span>
          </button>
          <button class="btn-load" onclick="loadFromSheets('investimentos')">
            <span>üì•</span>
            <span>Carregar do Sheets</span>
          </button>
          <button class="btn-export" onclick="exportToCSV('investimento')">Exportar CSV</button>
        </div>
      </div>
      
      <div class="data-table">
        <h3>Meus Investimentos</h3>
        <table id="investTable">
          <thead>
            <tr>
              <th class="sortable" onclick="sortTable('investTable', 0)">Ativo</th>
              <th class="sortable" onclick="sortTable('investTable', 1)">Modalidade</th>
              <th class="sortable" onclick="sortTable('investTable', 2)">Valor Investido</th>
              <th class="sortable" onclick="sortTable('investTable', 3)">Quantidade</th>
              <th class="sortable" onclick="sortTable('investTable', 4)">Provento</th>
              <th>Recorr√™ncia</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Continua√ß√£o com os demais m√≥dulos (Consigna√ß√£o, Anota√ß√µes, Vendas, Dashboard) -->
<!-- Aqui voc√™ deve incluir o resto do HTML original dos m√≥dulos -->

<div class="module-container" id="moduleConsignacao">
  <div class="module-content">
    <div class="module-header">
      <h2>ü§ù Controle de Empr√©stimos e Consigna√ß√£o</h2>
      <button class="btn-close" onclick="closeModule('consignacao')">&times;</button>
    </div>
    <div class="module-body">
      
      <div class="summary-section">
        <h3>Resumo de Empr√©stimos</h3>
        <div class="summary-grid">
          <div class="summary-card highlight">
            <h4>Total Emprestado</h4>
            <p id="totalEmprestado">R$ 0,00</p>
          </div>
          <div class="summary-card">
            <h4>Total Recebido</h4>
            <p id="totalRecebido">R$ 0,00</p>
          </div>
          <div class="summary-card warning">
            <h4>Em Aberto</h4>
            <p id="totalAberto">R$ 0,00</p>
          </div>
          <div class="summary-card danger">
            <h4>Atrasados</h4>
            <p id="totalAtrasado">0</p>
          </div>
        </div>
      </div>
      
      <div class="alert alert-warning">
        <span>‚ö†Ô∏è</span>
        <span>Juros m√°ximo permitido por lei: 100% ao m√™s. O sistema validar√° automaticamente.</span>
      </div>
      
      <div class="form-card" id="formConsignacao">
        <h3 id="consigFormTitle">Novo Empr√©stimo</h3>
        <input type="hidden" id="c_id">
        
        <!-- FILTROS CONSIGNA√á√ÉO -->
<div class="filter-section">
  <h3>üîç Filtros e Busca</h3>
  
  <!-- BUSCA -->
  <div style="margin-bottom: 15px;">
    <label style="font-weight: 600; color: #333; margin-bottom: 8px; display: block;">üîç Buscar:</label>
    <input type="text" id="searchConsignacao" placeholder="Digite para buscar (nome, contato...)" 
           style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 6px;" 
           oninput="buscarConsignacao()">
  </div>
  
  <!-- FILTROS -->
  <div class="filter-grid">
    <div class="form-group-inline">
      <label for="filterConsStatus">Status</label>
      <select id="filterConsStatus" onchange="filtrarConsignacao()">
        <option value="">Todos</option>
        <option value="pago">Pago</option>
        <option value="aberto">Em Aberto</option>
        <option value="atrasado">Atrasado</option>
      </select>
    </div>
    <div class="form-group-inline">
      <label for="filterConsDataInicio">Vencimento de:</label>
      <input type="date" id="filterConsDataInicio">
    </div>
    <div class="form-group-inline">
      <label for="filterConsDataFim">Vencimento at√©:</label>
      <input type="date" id="filterConsDataFim">
    </div>
  </div>
  
  <div style="margin-top: 10px; display: flex; gap: 10px;">
    <button class="btn-primary" onclick="filtrarConsignacao()">Aplicar Filtros</button>
    <button class="btn-secondary" onclick="limparFiltrosConsignacao()">Limpar</button>
  </div>
</div>
        
        <div class="form-grid">
          <div class="form-group-inline">
            <label for="c_nome">Nome do Tomador *</label>
            <input type="text" id="c_nome" placeholder="Nome completo" required>
          </div>
          
          <div class="form-group-inline">
            <label for="c_valor">Valor (R$) *</label>
            <input type="text" id="c_valor" placeholder="0,00" required>
          </div>
          
          <div class="form-group-inline">
            <label for="c_juros">Juros Mensal (%) *</label>
            <input type="number" id="c_juros" placeholder="0.00" step="0.01" max="5" required>
            <small style="color: #666; font-size: 11px;">M√°x: 5%</small>
          </div>
          
          <div class="form-group-inline">
            <label for="c_parcelas">N√∫mero de Parcelas *</label>
            <input type="number" id="c_parcelas" placeholder="1" min="1" required>
          </div>
          
          <div class="form-group-inline">
            <label for="c_vencimento">Data de Vencimento *</label>
            <input type="date" id="c_vencimento" required>
          </div>
          
          <div class="form-group-inline">
            <label for="c_contato">Contato (opcional)</label>
            <input type="text" id="c_contato" placeholder="Telefone ou email">
          </div>
        </div>
        
        <div class="action-buttons">
          <button class="btn-primary" id="btnSaveCons" onclick="saveConsignacao()">Adicionar Empr√©stimo</button>
          <button class="btn-secondary" id="btnCancelCons" onclick="resetConsForm()" style="display:none">Cancelar</button>
          <button class="btn-sync" onclick="syncToSheets('consignacoes')">
            <span>üîÑ</span>
            <span>Enviar para Sheets</span>
          </button>
          <button class="btn-load" onclick="loadFromSheets('consignacoes')">
            <span>üì•</span>
            <span>Carregar do Sheets</span>
          </button>
          <button class="btn-export" onclick="exportConsignacaoCSV()">Exportar CSV</button>
          <button class="btn-export" onclick="exportConsignacaoPDF()">Exportar PDF</button>
        </div>
      </div>
      
      <div class="data-table">
        <h3>Empr√©stimos Cadastrados</h3>
        <table id="consignacaoTable">
          <thead>
            <tr>
              <th class="sortable" onclick="sortTable('consignacaoTable', 0)">Nome</th>
              <th class="sortable" onclick="sortTable('consignacaoTable', 1)">Valor Inicial</th>
              <th class="sortable" onclick="sortTable('consignacaoTable', 2)">Juros</th>
              <th class="sortable" onclick="sortTable('consignacaoTable', 3)">Total com Juros</th>
              <th class="sortable" onclick="sortTable('consignacaoTable', 4)">Pago</th>
              <th class="sortable" onclick="sortTable('consignacaoTable', 5)">Vencimento</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      
      <div class="data-table">
        <h3>An√°lise Visual</h3>
        <div class="chart-container">
          <canvas id="consignacaoChart"></canvas>
        </div>
      </div>
      
    </div>
  </div>
</div>

<!-- M√ìDULO ANOTA√á√ïES -->
<div class="module-container" id="moduleAnotacoes">
  <div class="module-content">
    <div class="module-header">
      <h2>üìù Minhas Anota√ß√µes</h2>
      <button class="btn-close" onclick="closeModule('anotacoes')">&times;</button>
    </div>
    <div class="module-body">
      
      <div class="summary-section">
        <h3>Resumo por Prioridade</h3>
        <div class="summary-grid" id="anotacoesPrioritySummary"></div>
      </div>
      
      <div class="form-card" id="formAnot">
        <h3 id="anotFormTitle">Nova Anota√ß√£o</h3>
        <input type="hidden" id="a_id">
        
        <!-- FILTROS ANOTA√á√ïES -->
<div class="filter-section">
  <h3>üîç Filtros e Busca</h3>
  
  <!-- BUSCA -->
  <div style="margin-bottom: 15px;">
    <label style="font-weight: 600; color: #333; margin-bottom: 8px; display: block;">üîç Buscar:</label>
    <input type="text" id="searchAnotacoes" placeholder="Digite para buscar (t√≠tulo, notas...)" 
           style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 6px;" 
           oninput="buscarAnotacoes()">
  </div>
  
  <!-- FILTROS -->
  <div class="filter-grid">
    <div class="form-group-inline">
      <label for="filterAnotPrioridade">Prioridade</label>
      <select id="filterAnotPrioridade" onchange="filtrarAnotacoes()">
        <option value="">Todas</option>
        <option value="Alta">Alta</option>
        <option value="M√©dia">M√©dia</option>
        <option value="Baixa">Baixa</option>
      </select>
    </div>
  </div>
  
  <button class="btn-secondary" onclick="limparFiltrosAnotacoes()" style="margin-top: 10px;">Limpar Filtros</button>
</div>
        
        <div class="form-grid">
          <div class="form-group-inline">
            <label for="a_titulo">T√≠tulo *</label>
            <input type="text" id="a_titulo" placeholder="T√≠tulo da anota√ß√£o" required>
          </div>
          
          <div class="form-group-inline">
            <label for="a_prioridade">Prioridade</label>
            <select id="a_prioridade">
              <option>Baixa</option>
              <option>M√©dia</option>
              <option>Alta</option>
            </select>
          </div>
        </div>
        
        <div class="form-group-inline">
          <label for="a_notas">Notas/Descri√ß√£o</label>
          <textarea id="a_notas" rows="4" placeholder="Escreva suas anota√ß√µes aqui..."></textarea>
        </div>
        
        <div class="action-buttons">
          <button class="btn-primary" id="btnSaveAnot" onclick="saveAnotacao()">Adicionar Anota√ß√£o</button>
          <button class="btn-secondary" id="btnCancelAnot" onclick="resetAnotForm()" style="display:none">Cancelar</button>
          <button class="btn-sync" onclick="syncToSheets('anotacoes')">
            <span>üîÑ</span>
            <span>Enviar para Sheets</span>
          </button>
          <button class="btn-load" onclick="loadFromSheets('anotacoes')">
            <span>üì•</span>
            <span>Carregar do Sheets</span>
          </button>
          <button class="btn-export" onclick="exportToCSV('anotacoes')">Exportar CSV</button>
        </div>
      </div>
      
      <div class="data-table">
        <h3>Todas as Anota√ß√µes</h3>
        <table id="anotacoesTable">
          <thead>
            <tr>
              <th class="sortable" onclick="sortTable('anotacoesTable', 0)">T√≠tulo</th>
              <th class="sortable" onclick="sortTable('anotacoesTable', 1)">Prioridade</th>
              <th class="sortable" onclick="sortTable('anotacoesTable', 2)">Notas</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- M√ìDULO VENDAS -->
<div class="module-container" id="moduleVendas">
  <div class="module-content">
    <div class="module-header">
      <h2>üõçÔ∏è Gest√£o de Vendas</h2>
      <button class="btn-close" onclick="closeModule('vendas')">&times;</button>
    </div>
    <div class="module-body">
      <div class="summary-section">
        <h3>Resumo de Vendas</h3>
        <div class="summary-grid">
          <div class="summary-card highlight">
            <h4>Total em Vendas</h4>
            <p id="totalVendasBruto">R$ 0,00</p>
          </div>
          <div class="summary-card">
            <h4>Lucro L√≠quido</h4>
            <p id="totalLucroVendas">R$ 0,00</p>
          </div>
        </div>
      </div>

      <div class="form-card" id="formVendas">
        <h3>Nova Venda</h3>
        <div class="form-grid">
          <div class="form-group-inline">
            <label for="v_cliente">Cliente *</label>
            <input type="text" id="v_cliente" placeholder="Nome do cliente" required>
          </div>
          <div class="form-group-inline">
            <label for="v_tipo">Tipo</label>
            <select id="v_tipo">
              <option>Produto</option>
              <option>Servi√ßo</option>
            </select>
          </div>
          <div class="form-group-inline">
            <label for="v_custo">Custo (R$)</label>
            <input type="text" id="v_custo" placeholder="0,00">
          </div>
          <div class="form-group-inline">
            <label for="v_valor">Valor Venda (R$) *</label>
            <input type="text" id="v_valor" placeholder="0,00" required>
          </div>
          <div class="form-group-inline">
            <label for="v_descricao">Descri√ß√£o</label>
            <input type="text" id="v_descricao" placeholder="Descri√ß√£o da venda">
          </div>
        </div>
        
        <!-- FILTROS VENDAS -->
<div class="filter-section">
  <h3>üîç Filtros e Busca</h3>
  
  <!-- BUSCA -->
  <div style="margin-bottom: 15px;">
    <label style="font-weight: 600; color: #333; margin-bottom: 8px; display: block;">üîç Buscar:</label>
    <input type="text" id="searchVendas" placeholder="Digite para buscar (cliente, descri√ß√£o...)" 
           style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 6px;" 
           oninput="buscarVendas()">
  </div>
  
  <!-- FILTROS -->
  <div class="filter-grid">
    <div class="form-group-inline">
      <label for="filterVendasTipo">Tipo</label>
      <select id="filterVendasTipo" onchange="filtrarVendas()">
        <option value="">Todos</option>
        <option value="Produto">Produto</option>
        <option value="Servi√ßo">Servi√ßo</option>
      </select>
    </div>
    <div class="form-group-inline">
      <label for="filterVendasDataInicio">Data In√≠cio</label>
      <input type="date" id="filterVendasDataInicio">
    </div>
    <div class="form-group-inline">
      <label for="filterVendasDataFim">Data Fim</label>
      <input type="date" id="filterVendasDataFim">
    </div>
  </div>
  
  <div style="margin-top: 10px; display: flex; gap: 10px;">
    <button class="btn-primary" onclick="filtrarVendas()">Aplicar Filtros</button>
    <button class="btn-secondary" onclick="limparFiltrosVendas()">Limpar</button>
  </div>
</div>
        <div class="action-buttons">
          <button class="btn-primary" onclick="saveVenda()">Registrar Venda</button>
          <button class="btn-sync" onclick="syncToSheets('vendas')">
            <span>üîÑ</span>
            <span>Enviar para Sheets</span>
          </button>
          <button class="btn-load" onclick="loadFromSheets('vendas')">
            <span>üì•</span>
            <span>Carregar do Sheets</span>
          </button>
          <button class="btn-export" onclick="exportToCSV('vendas')">Exportar CSV</button>
        </div>
      </div>

      <div class="data-table">
        <h3>Hist√≥rico de Vendas</h3>
        <table id="vendasTable">
          <thead>
            <tr>
              <th class="sortable" onclick="sortTable('vendasTable', 0)">Data</th>
              <th class="sortable" onclick="sortTable('vendasTable', 1)">Cliente</th>
              <th class="sortable" onclick="sortTable('vendasTable', 2)">Valor</th>
              <th class="sortable" onclick="sortTable('vendasTable', 3)">Lucro</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- M√ìDULO DASHBOARD -->
<div class="module-container" id="moduleDashboard">
  <div class="module-content">
    <div class="module-header">
      <h2>üìä Dashboard Financeiro</h2>
      <button class="btn-close" onclick="closeModule('dashboard')">&times;</button>
    </div>
    <div class="module-body">
      
      <div class="alert alert-info">
        <span>‚ÑπÔ∏è</span>
        <span>Vis√£o consolidada de todas as suas finan√ßas, investimentos e empr√©stimos (com c√°lculo de recorr√™ncias)</span>
      </div>
      
      <div class="dashboard-grid">
        <div class="dashboard-card">
          <h3>Saldo Total</h3>
          <p id="dashSaldo">R$ 0,00</p>
          <small>Receitas - Despesas</small>
        </div>
        
        <div class="dashboard-card">
          <h3>Total Investido</h3>
          <p id="dashInvest">R$ 0,00</p>
          <small>Carteira de investimentos</small>
        </div>
        
        <div class="dashboard-card">
          <h3>Proventos Acumulados</h3>
          <p id="dashProv">R$ 0,00</p>
          <small>Renda passiva com recorr√™ncias</small>
        </div>
        
        <div class="dashboard-card">
          <h3>Empr√©stimos Ativos</h3>
          <p id="dashEmprestimos">R$ 0,00</p>
          <small>Valores em aberto</small>
        </div>
        
        <div class="dashboard-card">
          <h3>Patrim√¥nio Total</h3>
          <p id="dashPatrimonio">R$ 0,00</p>
          <small>Saldo + Investimentos + Empr√©stimos</small>
        </div>
      </div>
      
      <div class="data-table" style="margin-top: 30px;">
        <h3>Estat√≠sticas Gerais</h3>
        <table>
          <tr>
            <th style="cursor: default;">M√©trica</th>
            <th style="cursor: default;">Valor</th>
          </tr>
          <tr>
            <td><strong>Total de Receitas (com recorr√™ncias)</strong></td>
            <td id="totalReceitas"><strong>R$ 0,00</strong></td>
          </tr>
          <tr>
            <td><strong>Total de Despesas (com recorr√™ncias)</strong></td>
            <td id="totalDespesas"><strong>R$ 0,00</strong></td>
          </tr>
          <tr>
            <td>N√∫mero de Transa√ß√µes</td>
            <td id="numTransacoes">0</td>
          </tr>
          <tr>
            <td>N√∫mero de Investimentos</td>
            <td id="numInvestimentos">0</td>
          </tr>
          <tr>
            <td>N√∫mero de Empr√©stimos</td>
            <td id="numEmprestimos">0</td>
          </tr>
          <tr>
            <td>N√∫mero de Anota√ß√µes</td>
            <td id="numAnotacoes">0</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- STATUS DE SINCRONIZA√á√ÉO -->
<div class="sync-status" id="syncStatus">
  <div class="spinner" id="syncSpinner"></div>
  <span id="syncMessage"></span>
</div>

<script>
// ==================== CONFIGURA√á√ÉO ====================
let SHEETS_URL = localStorage.getItem('sheetsUrl') || '';

function salvarSheetsUrl() {
  const url = document.getElementById('sheetsUrlInput').value.trim();
  
  if (!url) {
    alert('Por favor, insira uma URL v√°lida!');
    return;
  }
  
  if (!url.includes('script.google.com')) {
    alert('URL inv√°lida! Deve ser uma URL do Google Apps Script.');
    return;
  }
  
  SHEETS_URL = url;
  localStorage.setItem('sheetsUrl', url);
  atualizarStatusUrl();
  alert('‚úÖ URL salva com sucesso! A sincroniza√ß√£o j√° est√° ativa.');
}

function atualizarStatusUrl() {
  const statusEl = document.getElementById('urlStatus');
  const inputEl = document.getElementById('sheetsUrlInput');
  
  if (SHEETS_URL) {
    statusEl.textContent = '‚úÖ Configurado e ativo';
    statusEl.style.color = '#28a745';
    statusEl.style.fontWeight = 'bold';
    inputEl.value = SHEETS_URL;
  } else {
    statusEl.textContent = '‚ùå N√£o configurado';
    statusEl.style.color = '#e74c3c';
    statusEl.style.fontWeight = 'bold';
  }
}

// ==================== DADOS ====================
let usuario = JSON.parse(localStorage.getItem('usuario')) || null;
let financeiro = JSON.parse(localStorage.getItem('financeiro')) || [];
let investimentos = JSON.parse(localStorage.getItem('investimentos')) || [];
let consignacoes = JSON.parse(localStorage.getItem('consignacoes')) || [];
let anotacoes = JSON.parse(localStorage.getItem('anotacoes')) || [];
let vendas = JSON.parse(localStorage.getItem('vendas')) || [];
let consignacaoChart = null;

// ==================== FUN√á√ïES DE SINCRONIZA√á√ÉO ====================
function showSyncStatus(message, type = 'syncing') {
  const status = document.getElementById('syncStatus');
  const spinner = document.getElementById('syncSpinner');
  const messageEl = document.getElementById('syncMessage');
  
  status.className = 'sync-status show ' + type;
  messageEl.textContent = message;
  
  if (type === 'syncing') {
    spinner.style.display = 'block';
  } else {
    spinner.style.display = 'none';
  }
  
  if (type !== 'syncing') {
    setTimeout(() => {
      status.classList.remove('show');
    }, 3000);
  }
}

async function syncToSheets(tipo) {
  if (!SHEETS_URL) {
    alert('‚ö†Ô∏è Configure primeiro a URL do Google Sheets nas Configura√ß√µes!');
    return;
  }
  
  showSyncStatus('Sincronizando dados...', 'syncing');
  
  try {
    let data;
    let sheetName;
    
    switch(tipo) {
      case 'financeiro':
        data = financeiro;
        sheetName = 'Financeiro';
        break;
      case 'investimentos':
        data = investimentos;
        sheetName = 'Investimentos';
        break;
      case 'consignacoes':
        data = consignacoes;
        sheetName = 'Consignacao';
        break;
      case 'anotacoes':
        data = anotacoes;
        sheetName = 'Anotacoes';
        break;
      case 'vendas':
        data = vendas;
        sheetName = 'Vendas';
        break;
      default:
        throw new Error('Tipo de dados inv√°lido');
    }
    
    const response = await fetch(SHEETS_URL + '?action=write', {
      method: 'POST',
      headers: {
        'Content-Type': 'text/plain',
      },
      body: JSON.stringify({
        sheet: sheetName,
        data: data
      })
    });
    
    const result = await response.json();
    
    if (result.status === 'success') {
      showSyncStatus('‚úì Dados sincronizados com sucesso!', 'success');
      console.log('Sincroniza√ß√£o conclu√≠da:', tipo);
    } else {
      throw new Error(result.message || 'Erro desconhecido');
    }
    
  } catch (error) {
    console.error('Erro ao sincronizar:', error);
    showSyncStatus('‚úó Erro na sincroniza√ß√£o: ' + error.message, 'error');
  }
}

async function loadFromSheets(tipo) {
  if (!SHEETS_URL) {
    alert('‚ö†Ô∏è Configure primeiro a URL do Google Sheets nas Configura√ß√µes!');
    return;
  }
  
  showSyncStatus('Carregando dados do Sheets...', 'syncing');
  
  try {
    let sheetName;
    
    switch(tipo) {
      case 'financeiro':
        sheetName = 'Financeiro';
        break;
      case 'investimentos':
        sheetName = 'Investimentos';
        break;
      case 'consignacoes':
        sheetName = 'Consignacao';
        break;
      case 'anotacoes':
        sheetName = 'Anotacoes';
        break;
      case 'vendas':
        sheetName = 'Vendas';
        break;
      default:
        throw new Error('Tipo de dados inv√°lido');
    }
    
    const response = await fetch(`${SHEETS_URL}?action=read&sheet=${sheetName}`);
    const result = await response.json();
    
    if (result.status === 'success' && result.data) {
      switch(tipo) {
        case 'financeiro':
          financeiro = result.data;
          localStorage.setItem('financeiro', JSON.stringify(financeiro));
          renderFinanceiro();
          renderFinanceiroCategorySummary();
          break;
        case 'investimentos':
          investimentos = result.data;
          localStorage.setItem('investimentos', JSON.stringify(investimentos));
          renderInvestimentos();
          renderInvestimentoModalitySummary();
          break;
        case 'consignacoes':
          consignacoes = result.data;
          localStorage.setItem('consignacoes', JSON.stringify(consignacoes));
          renderConsignacoes();
          renderConsignacaoSummary();
          renderConsignacaoChart();
          break;
        case 'anotacoes':
          anotacoes = result.data;
          localStorage.setItem('anotacoes', JSON.stringify(anotacoes));
          renderAnotacoes();
          renderAnotacoesPrioritySummary();
          break;
        case 'vendas':
          vendas = result.data;
          localStorage.setItem('vendas', JSON.stringify(vendas));
          renderVendas();
          break;
      }
      
      showSyncStatus('‚úì Dados carregados com sucesso!', 'success');
    } else {
      throw new Error(result.message || 'Erro ao carregar dados');
    }
    
  } catch (error) {
    console.error('Erro ao carregar do Sheets:', error);
    showSyncStatus('‚úó Erro ao carregar dados: ' + error.message, 'error');
  }
}

// ==================== C√ÅLCULO DE RECORR√äNCIAS ====================
function calculateRecurrenceOccurrences(startDate, recurrence) {
  if (!startDate || recurrence === 'N√£o') return 1;
  
  const start = new Date(startDate);
  const today = new Date();
  
  if (start > today) {
    return 1;
  }
  
  const diffTime = Math.abs(today - start);
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  
  switch(recurrence) {
    case 'Di√°rio':
      return diffDays + 1;
    case 'Mensal':
      const months = (today.getFullYear() - start.getFullYear()) * 12 + (today.getMonth() - start.getMonth());
      return Math.max(1, months + 1);
    case 'Bimestral':
      const bimesters = Math.floor(((today.getFullYear() - start.getFullYear()) * 12 + (today.getMonth() - start.getMonth())) / 2);
      return Math.max(1, bimesters + 1);
    case 'Trimestral':
      const quarters = Math.floor(((today.getFullYear() - start.getFullYear()) * 12 + (today.getMonth() - start.getMonth())) / 3);
      return Math.max(1, quarters + 1);
    case 'Semestral':
      const semesters = Math.floor(((today.getFullYear() - start.getFullYear()) * 12 + (today.getMonth() - start.getMonth())) / 6);
      return Math.max(1, semesters + 1);
    case 'Anual':
      const years = today.getFullYear() - start.getFullYear();
      return Math.max(1, years + 1);
    default:
      return 1;
  }
}

function calculateRecurringValue(value, startDate, recurrence) {
  if (recurrence === 'N√£o' || !recurrence) {
    return value;
  }
  
  const occurrences = calculateRecurrenceOccurrences(startDate, recurrence);
  return value * occurrences;
}

// ==================== FORMATA√á√ÉO DE MOEDA ====================
function formatCurrency(input) {
  let value = input.value.replace(/\D/g, '');
  value = (value / 100).toFixed(2);
  value = value.replace('.', ',');
  value = value.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
  input.value = value;
}

function parseCurrency(value) {
  if (typeof value === 'number') return value;
  if (!value) return 0;
  return parseFloat(value.replace(/\./g, '').replace(',', '.')) || 0;
}

function displayCurrency(value) {
  return new Intl.NumberFormat('pt-BR', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }).format(value);
}

// ==================== INICIALIZA√á√ÉO ====================
window.onload = function() {
  // Configurar URL automaticamente (COLE SEU LINK AQUI)
  if (!SHEETS_URL) {
    SHEETS_URL = 'https://script.google.com/macros/s/AKfycbz87X1rzOfnWs0yD9eONGMCD4KJq-J8aVZUUMapb-T3HezGru52LPdwRUYPS8d2FnxHEw/exec';
    localStorage.setItem('sheetsUrl', SHEETS_URL);
  }
  
  if (usuario) {
    mostrarTelaPrincipal();
    // CARREGAR TODOS OS DADOS AUTOMATICAMENTE AO INICIAR
    autoLoadAllData();
  }
  
  atualizarStatusUrl();
  
  // Adicionar formata√ß√£o de moeda aos campos
  const currencyInputs = ['f_valor', 'i_valor', 'i_prov', 'c_valor', 'v_custo', 'v_valor'];
  currencyInputs.forEach(id => {
    const input = document.getElementById(id);
    if (input) {
      input.addEventListener('input', function() {
        formatCurrency(this);
      });
    }
  });
  
  // Fecha m√≥dulos com ESC
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const activeModule = document.querySelector('.module-container.active');
      if (activeModule) {
        const moduleId = activeModule.id.replace('module', '').toLowerCase();
        closeModule(moduleId);
      }
    }
  });
};

// ==================== FECHAR M√ìDULOS (CORRIGIDO) ====================
function closeModule(module) {
  // Normalizar o nome do m√≥dulo
  const moduleName = module.toLowerCase().replace(/[^a-z]/g, '');
  
  // Lista de IDs de m√≥dulos v√°lidos
  const moduleIds = {
    'configuracao': 'moduleConfiguracao',
    'financeiro': 'moduleFinanceiro',
    'investimento': 'moduleInvestimento',
    'consignacao': 'moduleConsignacao',
    'anotacoes': 'moduleAnotacoes',
    'vendas': 'moduleVendas',
    'dashboard': 'moduleDashboard'
  };
  
  // Obter o ID correto do m√≥dulo
  const moduleId = moduleIds[moduleName];
  
  if (moduleId) {
    const moduleElement = document.getElementById(moduleId);
    if (moduleElement) {
      moduleElement.classList.remove('active');
      
      // Resetar formul√°rios espec√≠ficos
      if (moduleName === 'financeiro') resetFinForm();
      if (moduleName === 'investimento') resetInvForm();
      if (moduleName === 'consignacao') resetConsForm();
      if (moduleName === 'anotacoes') resetAnotForm();
      if (moduleName === 'vendas') limparFormVendas();
      
      console.log('‚úÖ M√≥dulo fechado:', moduleName);
    } else {
      console.error('‚ùå Elemento do m√≥dulo n√£o encontrado:', moduleId);
    }
  } else {
    console.error('‚ùå M√≥dulo n√£o reconhecido:', moduleName);
  }
}


// ==================== CARREGAMENTO AUTOM√ÅTICO ====================
async function autoLoadAllData() {
  if (!SHEETS_URL) return;
  
  console.log('üîÑ Carregando dados do Google Sheets...');
  
  try {
    // Carregar Financeiro
    const finResponse = await fetch(`${SHEETS_URL}?action=read&sheet=Financeiro`);
    const finResult = await finResponse.json();
    if (finResult.status === 'success' && finResult.data && finResult.data.length > 0) {
      financeiro = finResult.data;
      localStorage.setItem('financeiro', JSON.stringify(financeiro));
      console.log('‚úÖ Financeiro carregado:', financeiro.length, 'registros');
    }
  } catch (e) {
    console.log('‚ö†Ô∏è Erro ao carregar Financeiro:', e.message);
  }
  
  try {
    // Carregar Investimentos
    const invResponse = await fetch(`${SHEETS_URL}?action=read&sheet=Investimentos`);
    const invResult = await invResponse.json();
    if (invResult.status === 'success' && invResult.data && invResult.data.length > 0) {
      investimentos = invResult.data;
      localStorage.setItem('investimentos', JSON.stringify(investimentos));
      console.log('‚úÖ Investimentos carregado:', investimentos.length, 'registros');
    }
  } catch (e) {
    console.log('‚ö†Ô∏è Erro ao carregar Investimentos:', e.message);
  }
  
  try {
    // Carregar Consigna√ß√£o
    const consResponse = await fetch(`${SHEETS_URL}?action=read&sheet=Consignacao`);
    const consResult = await consResponse.json();
    if (consResult.status === 'success' && consResult.data && consResult.data.length > 0) {
      consignacoes = consResult.data;
      localStorage.setItem('consignacoes', JSON.stringify(consignacoes));
      console.log('‚úÖ Consigna√ß√£o carregado:', consignacoes.length, 'registros');
    }
  } catch (e) {
    console.log('‚ö†Ô∏è Erro ao carregar Consigna√ß√£o:', e.message);
  }
  
  try {
    // Carregar Anota√ß√µes
    const anotResponse = await fetch(`${SHEETS_URL}?action=read&sheet=Anotacoes`);
    const anotResult = await anotResponse.json();
    if (anotResult.status === 'success' && anotResult.data && anotResult.data.length > 0) {
      anotacoes = anotResult.data;
      localStorage.setItem('anotacoes', JSON.stringify(anotacoes));
      console.log('‚úÖ Anota√ß√µes carregado:', anotacoes.length, 'registros');
    }
  } catch (e) {
    console.log('‚ö†Ô∏è Erro ao carregar Anota√ß√µes:', e.message);
  }
  
  try {
    // Carregar Vendas
    const vendasResponse = await fetch(`${SHEETS_URL}?action=read&sheet=Vendas`);
    const vendasResult = await vendasResponse.json();
    if (vendasResult.status === 'success' && vendasResult.data && vendasResult.data.length > 0) {
      vendas = vendasResult.data;
      localStorage.setItem('vendas', JSON.stringify(vendas));
      console.log('‚úÖ Vendas carregado:', vendas.length, 'registros');
    }
  } catch (e) {
    console.log('‚ö†Ô∏è Erro ao carregar Vendas:', e.message);
  }
  
  console.log('‚úÖ Carregamento autom√°tico conclu√≠do!');
}
// ==================== SINCRONIZA√á√ÉO EM MASSA ====================
async function syncAllToSheets() {
  if (!SHEETS_URL) {
    alert('‚ö†Ô∏è Configure a URL do Google Sheets primeiro!');
    return;
  }
  
  if (!confirm('Deseja enviar TODOS os dados para o Google Sheets?')) {
    return;
  }
  
  showSyncStatus('Enviando todos os dados...', 'syncing');
  
  let sucessos = 0;
  let erros = 0;
  
  // Sincronizar cada m√≥dulo
  const modulos = [
    { tipo: 'financeiro', data: financeiro, nome: 'Financeiro' },
    { tipo: 'investimentos', data: investimentos, nome: 'Investimentos' },
    { tipo: 'consignacoes', data: consignacoes, nome: 'Consignacao' },
    { tipo: 'anotacoes', data: anotacoes, nome: 'Anotacoes' },
    { tipo: 'vendas', data: vendas, nome: 'Vendas' }
  ];
  
  for (const mod of modulos) {
    try {
      const response = await fetch(SHEETS_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify({ sheet: mod.nome, data: mod.data })
      });
      
      const result = await response.json();
      
      if (result.status === 'success') {
        sucessos++;
        console.log(`‚úÖ ${mod.tipo} sincronizado`);
      } else {
        erros++;
        console.error(`‚ùå Erro em ${mod.tipo}:`, result.message);
      }
    } catch (error) {
      erros++;
      console.error(`‚ùå Erro em ${mod.tipo}:`, error);
    }
  }
  
  if (erros === 0) {
    showSyncStatus(`‚úÖ Todos os dados foram sincronizados! (${sucessos} m√≥dulos)`, 'success');
  } else {
    showSyncStatus(`‚ö†Ô∏è Sincroniza√ß√£o parcial: ${sucessos} OK, ${erros} com erro`, 'error');
  }
}

async function loadAllFromSheets() {
  if (!SHEETS_URL) {
    alert('‚ö†Ô∏è Configure a URL do Google Sheets primeiro!');
    return;
  }
  
  if (!confirm('Deseja carregar TODOS os dados do Google Sheets? Isso substituir√° os dados locais.')) {
    return;
  }
  
  showSyncStatus('Carregando todos os dados...', 'syncing');
  
  await autoLoadAllData();
  
  showSyncStatus('‚úÖ Todos os dados foram carregados!', 'success');
  alert('‚úÖ Dados carregados com sucesso! Abra qualquer m√≥dulo para ver.');
}

// ==================== LOGIN ====================
function fazerLogin(event) {
  event.preventDefault();
  
  const nome = document.getElementById('loginNome').value.trim();
  if (!nome) {
    alert('Por favor, preencha o nome!');
    return;
  }
  
  usuario = {
    nome: nome,
    email: document.getElementById('loginEmail').value
  };
  
  localStorage.setItem('usuario', JSON.stringify(usuario));
  mostrarTelaPrincipal();
}

function mostrarTelaPrincipal() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('mainScreen').classList.add('active');
  document.getElementById('userName').textContent = `Ol√°, ${usuario.nome}!`;
}

function fazerLogout() {
  if (confirm('Deseja realmente sair do sistema?')) {
    document.getElementById('mainScreen').classList.remove('active');
    document.getElementById('loginScreen').style.display = 'block';
  }
}

// ==================== M√ìDULOS ====================
function openModule(module) {
  document.getElementById('module' + module.charAt(0).toUpperCase() + module.slice(1)).classList.add('active');
  
  if (module === 'financeiro') {
    renderFinanceiro();
    renderFinanceiroCategorySummary();
  }
  if (module === 'investimento') {
    renderInvestimentos();
    renderInvestimentoModalitySummary();
  }
  if (module === 'consignacao') {
    renderConsignacoes();
    renderConsignacaoSummary();
    renderConsignacaoChart();
  }
  if (module === 'anotacoes') {
    renderAnotacoes();
    renderAnotacoesPrioritySummary();
  }
  if (module === 'vendas') {
    renderVendas();
  }
  if (module === 'dashboard') {
    renderDashboard();
  }
  if (module === 'configuracao') {
    atualizarStatusUrl();
  }
}

// (Aqui voc√™ deve incluir todo o resto do JavaScript original do sistema)
// As fun√ß√µes de saveFinanceiro, renderFinanceiro, editFinanceiro, deleteFinanceiro, etc.
// Por brevidade, n√£o vou repetir todo o c√≥digo, mas todas as fun√ß√µes originais devem estar aqui

// ==================== FINANCEIRO ====================
function saveFinanceiro() {
  const id = document.getElementById('f_id').value;
  const item = {
    id: id ? parseInt(id) : Date.now(),
    data: document.getElementById('f_data').value,
    tipo: document.getElementById('f_tipo').value,
    valor: parseCurrency(document.getElementById('f_valor').value),
    descricao: document.getElementById('f_desc').value,
    categoria: document.getElementById('f_cat').value,
    recorrente: document.getElementById('f_rec').value
  };
  
  if (!item.data || !item.descricao || item.valor === 0) {
    alert('Preencha todos os campos obrigat√≥rios!');
    return;
  }
  
  if (id) {
    const index = financeiro.findIndex(f => f.id === item.id);
    financeiro[index] = item;
  } else {
    financeiro.push(item);
  }
  
  localStorage.setItem('financeiro', JSON.stringify(financeiro));
  resetFinForm();
  renderFinanceiro();
  renderFinanceiroCategorySummary();
}

function renderFinanceiro(filtered = null) {
  const data = filtered || financeiro;
  const table = document.getElementById('financeiroTable');
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = '';
  
  const sortedData = [...data].sort((a, b) => new Date(b.data) - new Date(a.data));
  
  sortedData.forEach(item => {
    const row = tbody.insertRow(-1);
    const dataFormatada = new Date(item.data).toLocaleString('pt-BR');
    
    const valorTotal = calculateRecurringValue(item.valor, item.data, item.recorrente);
    const occurrences = calculateRecurrenceOccurrences(item.data, item.recorrente);
    
    let recorrenciaInfo = item.recorrente;
    if (item.recorrente !== 'N√£o' && occurrences > 1) {
      recorrenciaInfo += ` (${occurrences}x = R$ ${displayCurrency(valorTotal)})`;
    }
    
    let badgeColor = '#d1ecf1';
    let textColor = '#0c5460';
    
    if (item.tipo === 'Recebido' || item.tipo === 'A Receber') {
      badgeColor = '#d4edda';
      textColor = '#155724';
    } else if (item.tipo === 'Pago' || item.tipo === 'Pagar') {
      badgeColor = '#f8d7da';
      textColor = '#721c24';
    }
    
    row.innerHTML = `
      <td>${dataFormatada}</td>
      <td><span style="padding: 4px 8px; border-radius: 4px; background: ${badgeColor}; color: ${textColor};">${item.tipo}</span></td>
      <td>${item.descricao}</td>
      <td>${item.categoria}</td>
      <td><strong>R$ ${displayCurrency(item.valor)}</strong></td>
      <td>${recorrenciaInfo}</td>
      <td>
        <button class="btn-edit" onclick="editFinanceiro(${item.id})">Editar</button>
        <button class="btn-delete" onclick="deleteFinanceiro(${item.id})">Excluir</button>
      </td>
    `;
  });
}

function editFinanceiro(id) {
  const item = financeiro.find(f => f.id === id);
  document.getElementById('f_id').value = item.id;
  document.getElementById('f_data').value = item.data;
  document.getElementById('f_tipo').value = item.tipo;
  document.getElementById('f_valor').value = displayCurrency(item.valor);
  document.getElementById('f_desc').value = item.descricao;
  document.getElementById('f_cat').value = item.categoria;
  document.getElementById('f_rec').value = item.recorrente;
  
  document.getElementById('finFormTitle').textContent = "Editando Transa√ß√£o";
  document.getElementById('btnSaveFin').textContent = "Salvar Altera√ß√µes";
  document.getElementById('btnCancelFin').style.display = "inline-block";
  document.getElementById('formFinanceiro').classList.add('editing');
  
  document.getElementById('formFinanceiro').scrollIntoView({behavior: 'smooth', block: 'start'});
}

function resetFinForm() {
  document.getElementById('f_id').value = "";
  document.getElementById('f_data').value = "";
  document.getElementById('f_valor').value = "";
  document.getElementById('f_desc').value = "";
  document.getElementById('f_cat').selectedIndex = 0;
  document.getElementById('f_rec').selectedIndex = 0;
  document.getElementById('finFormTitle').textContent = "Nova Transa√ß√£o";
  document.getElementById('btnSaveFin').textContent = "Adicionar Transa√ß√£o";
  document.getElementById('btnCancelFin').style.display = "none";
  document.getElementById('formFinanceiro').classList.remove('editing');
}

function deleteFinanceiro(id) {
  if (confirm('Deseja realmente excluir esta transa√ß√£o?')) {
    financeiro = financeiro.filter(item => item.id !== id);
    localStorage.setItem('financeiro', JSON.stringify(financeiro));
    renderFinanceiro();
    renderFinanceiroCategorySummary();
  }
}

function renderFinanceiroCategorySummary() {
  const summary = {};
  
  financeiro.forEach(item => {
    if (!summary[item.categoria]) {
      summary[item.categoria] = { total: 0, count: 0, occurrences: 0 };
    }
    
    const valorRecorrente = calculateRecurringValue(item.valor, item.data, item.recorrente);
    const occurrences = calculateRecurrenceOccurrences(item.data, item.recorrente);
    
    if (item.tipo === 'Pagar' || item.tipo === 'Pago') {
      summary[item.categoria].total -= valorRecorrente;
    } else {
      summary[item.categoria].total += valorRecorrente;
    }
    summary[item.categoria].count++;
    summary[item.categoria].occurrences += occurrences;
  });
  
  const container = document.getElementById('financeiroCategorySummary');
  container.innerHTML = '';
  
  Object.keys(summary).sort().forEach(categoria => {
    const card = document.createElement('div');
    card.className = 'summary-card';
    if (summary[categoria].total < 0) {
      card.classList.add('danger');
    } else if (summary[categoria].total > 0) {
      card.classList.add('highlight');
    } else {
      card.classList.add('warning');
    }
    
    card.innerHTML = `
      <h4>${categoria}</h4>
      <p>R$ ${displayCurrency(Math.abs(summary[categoria].total))}</p>
      <small style="opacity: 0.8; font-size: 12px;">${summary[categoria].count} transa√ß√µes</small>
      <div class="recurrence-info">${summary[categoria].occurrences} ocorr√™ncias calculadas</div>
    `;
    container.appendChild(card);
  });
}

function applyFinanceiroFilters() {
  const dataInicio = document.getElementById('filterFinDataInicio').value;
  const dataFim = document.getElementById('filterFinDataFim').value;
  const tipo = document.getElementById('filterFinTipo').value;
  const categoria = document.getElementById('filterFinCategoria').value;
  
  const filtered = financeiro.filter(item => {
    const itemDate = new Date(item.data);
    let match = true;
    
    if (dataInicio && itemDate < new Date(dataInicio)) match = false;
    if (dataFim && itemDate > new Date(dataFim + 'T23:59:59')) match = false;
    if (tipo && item.tipo !== tipo) match = false;
    if (categoria && item.categoria !== categoria) match = false;
    
    return match;
  });
  
  renderFinanceiro(filtered);
  alert(`Encontrados ${filtered.length} resultado(s)`);
}

function clearFinanceiroFilters() {
  document.getElementById('filterFinDataInicio').value = '';
  document.getElementById('filterFinDataFim').value = '';
  document.getElementById('filterFinTipo').value = '';
  document.getElementById('filterFinCategoria').value = '';
  renderFinanceiro();
}

// ==================== INVESTIMENTOS ====================
function saveInvestimento() {
  const id = document.getElementById('i_id').value;
  const item = {
    id: id ? parseInt(id) : Date.now(),
    ativo: document.getElementById('i_ativo').value,
    modalidade: document.getElementById('i_mod').value,
    data: document.getElementById('i_data').value,
    valor: parseCurrency(document.getElementById('i_valor').value),
    quantidade: parseFloat(document.getElementById('i_qtd').value) || 0,
    provento: parseCurrency(document.getElementById('i_prov').value),
    recorrente: document.getElementById('i_rec').value
  };
  
  if (!item.ativo || item.valor === 0) {
    alert('Preencha os campos obrigat√≥rios!');
    return;
  }
  
  if (id) {
    const index = investimentos.findIndex(i => i.id === item.id);
    investimentos[index] = item;
  } else {
    investimentos.push(item);
  }
  
  localStorage.setItem('investimentos', JSON.stringify(investimentos));
  resetInvForm();
  renderInvestimentos();
  renderInvestimentoModalitySummary();
}

function renderInvestimentos(filtered = null) {
  const data = filtered || investimentos;
  const table = document.getElementById('investTable');
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = '';
  
  const sortedData = [...data].sort((a, b) => a.ativo.localeCompare(b.ativo));
  
  sortedData.forEach(item => {
    const row = tbody.insertRow(-1);
    
    const proventoTotal = calculateRecurringValue(item.provento, item.data, item.recorrente);
    const occurrences = calculateRecurrenceOccurrences(item.data, item.recorrente);
    
    let recorrenciaInfo = item.recorrente || 'N√£o';
    if (item.recorrente && item.recorrente !== 'N√£o' && item.provento > 0 && occurrences > 1) {
      recorrenciaInfo += ` (${occurrences}x = R$ ${displayCurrency(proventoTotal)})`;
    }
    
    row.innerHTML = `
      <td><strong>${item.ativo}</strong></td>
      <td>${item.modalidade}</td>
      <td>R$ ${displayCurrency(item.valor)}</td>
      <td>${item.quantidade > 0 ? item.quantidade : '-'}</td>
      <td>R$ ${displayCurrency(item.provento)}</td>
      <td>${recorrenciaInfo}</td>
      <td>
        <button class="btn-edit" onclick="editInvestimento(${item.id})">Editar</button>
        <button class="btn-delete" onclick="deleteInvestimento(${item.id})">Excluir</button>
      </td>
    `;
  });
}

function editInvestimento(id) {
  const item = investimentos.find(i => i.id === id);
  document.getElementById('i_id').value = item.id;
  document.getElementById('i_ativo').value = item.ativo;
  document.getElementById('i_mod').value = item.modalidade;
  document.getElementById('i_data').value = item.data || '';
  document.getElementById('i_valor').value = displayCurrency(item.valor);
  document.getElementById('i_qtd').value = item.quantidade || '';
  document.getElementById('i_prov').value = displayCurrency(item.provento);
  document.getElementById('i_rec').value = item.recorrente || 'N√£o';
  
  document.getElementById('invFormTitle').textContent = "Editando Investimento";
  document.getElementById('btnSaveInv').textContent = "Salvar Altera√ß√µes";
  document.getElementById('btnCancelInv').style.display = "inline-block";
  document.getElementById('formInvest').classList.add('editing');
  
  document.getElementById('formInvest').scrollIntoView({behavior: 'smooth', block: 'start'});
}

function resetInvForm() {
  document.getElementById('i_id').value = "";
  document.getElementById('i_ativo').value = "";
  document.getElementById('i_data').value = "";
  document.getElementById('i_valor').value = "";
  document.getElementById('i_qtd').value = "";
  document.getElementById('i_prov').value = "";
  document.getElementById('i_rec').selectedIndex = 0;
  document.getElementById('invFormTitle').textContent = "Novo Investimento";
  document.getElementById('btnSaveInv').textContent = "Adicionar Investimento";
  document.getElementById('btnCancelInv').style.display = "none";
  document.getElementById('formInvest').classList.remove('editing');
}

function deleteInvestimento(id) {
  if (confirm('Deseja realmente excluir este investimento?')) {
    investimentos = investimentos.filter(item => item.id !== id);
    localStorage.setItem('investimentos', JSON.stringify(investimentos));
    renderInvestimentos();
    renderInvestimentoModalitySummary();
  }
}

function renderInvestimentoModalitySummary() {
  const summary = {};
  
  investimentos.forEach(item => {
    if (!summary[item.modalidade]) {
      summary[item.modalidade] = { total: 0, count: 0, proventos: 0, occurrences: 0 };
    }
    summary[item.modalidade].total += item.valor;
    
    const proventoRecorrente = calculateRecurringValue(item.provento, item.data, item.recorrente);
    const occurrences = calculateRecurrenceOccurrences(item.data, item.recorrente);
    
    summary[item.modalidade].proventos += proventoRecorrente;
    summary[item.modalidade].count++;
    summary[item.modalidade].occurrences += occurrences;
  });
  
  const container = document.getElementById('investimentoModalitySummary');
  container.innerHTML = '';
  
  Object.keys(summary).sort().forEach(modalidade => {
    const card = document.createElement('div');
    card.className = 'summary-card';
    
    card.innerHTML = `
      <h4>${modalidade}</h4>
      <p>R$ ${displayCurrency(summary[modalidade].total)}</p>
      <small style="opacity: 0.8; font-size: 12px;">${summary[modalidade].count} ativos</small><br>
      <small style="opacity: 0.8; font-size: 11px;">Proventos: R$ ${displayCurrency(summary[modalidade].proventos)}</small>
      <div class="recurrence-info">${summary[modalidade].occurrences} ocorr√™ncias calculadas</div>
    `;
    container.appendChild(card);
  });
}

// (Continue com as demais fun√ß√µes: Consigna√ß√£o, Anota√ß√µes, Vendas, Dashboard, etc.)
// Por brevidade, n√£o vou repetir todo o c√≥digo, mas voc√™ deve incluir todas as fun√ß√µes originais aqui
// ==================== CONSIGNA√á√ÉO ====================
function saveConsignacao() {
  const juros = parseFloat(document.getElementById('c_juros').value);
  
  if (juros > 100) {
    alert('Juros m√°ximo permitido por lei: 100% ao m√™s');
    return;
  }
  
  const id = document.getElementById('c_id').value;
  const valor = parseCurrency(document.getElementById('c_valor').value);
  const item = {
    id: id ? parseInt(id) : Date.now(),
    nome: document.getElementById('c_nome').value,
    valor: valor,
    juros: juros,
    parcelas: parseInt(document.getElementById('c_parcelas').value),
    vencimento: document.getElementById('c_vencimento').value,
    contato: document.getElementById('c_contato').value || '',
    pago: 0,
    total: valor * (1 + juros / 100)
  };
  
  if (!item.nome || item.valor === 0 || !item.vencimento) {
    alert('Preencha todos os campos obrigat√≥rios!');
    return;
  }
  
  if (id) {
    const index = consignacoes.findIndex(c => c.id === item.id);
    consignacoes[index] = item;
  } else {
    consignacoes.push(item);
  }
  
  localStorage.setItem('consignacoes', JSON.stringify(consignacoes));
  resetConsForm();
  renderConsignacoes();
  renderConsignacaoSummary();
  renderConsignacaoChart();
}

function renderConsignacoes() {
  const table = document.getElementById('consignacaoTable');
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = '';
  
  const sortedData = [...consignacoes].sort((a, b) => new Date(a.vencimento) - new Date(b.vencimento));
  
  sortedData.forEach(item => {
    const row = tbody.insertRow(-1);
    
    let status = 'Em Aberto';
    let statusClass = 'status-aberto';
    
    if (item.pago >= item.total) {
      status = 'Pago';
      statusClass = 'status-pago';
    } else if (new Date(item.vencimento) < new Date()) {
      status = 'Atrasado';
      statusClass = 'status-atrasado';
    }
    
    const restante = item.total - item.pago;
    const valorParcela = item.total / item.parcelas;
    
    row.innerHTML = `
      <td><strong>${item.nome}</strong>${item.contato ? '<br><small>' + item.contato + '</small>' : ''}</td>
      <td>R$ ${displayCurrency(item.valor)}</td>
      <td>${item.juros.toFixed(2)}%</td>
      <td>R$ ${displayCurrency(item.total)}</td>
      <td>R$ ${displayCurrency(item.pago)}<br><small>Restam: R$ ${displayCurrency(restante)}</small></td>
      <td>${new Date(item.vencimento).toLocaleDateString('pt-BR')}<br><small>${item.parcelas}x de R$ ${displayCurrency(valorParcela)}</small></td>
      <td><span class="${statusClass}">${status}</span></td>
      <td>
        <button class="btn-success" onclick="pagarParcela(${item.id})" ${item.pago >= item.total ? 'disabled' : ''}>Pagar Parcela</button><br>
        <button class="btn-edit" onclick="editConsignacao(${item.id})" style="margin-top:5px">Editar</button>
        <button class="btn-delete" onclick="deleteConsignacao(${item.id})" style="margin-top:5px">Excluir</button>
      </td>
    `;
  });
}

function pagarParcela(id) {
  const item = consignacoes.find(c => c.id === id);
  const valorParcela = item.total / item.parcelas;
  
  item.pago += valorParcela;
  if (item.pago > item.total) {
    item.pago = item.total;
  }
  
  localStorage.setItem('consignacoes', JSON.stringify(consignacoes));
  renderConsignacoes();
  renderConsignacaoSummary();
  renderConsignacaoChart();
}

function editConsignacao(id) {
  const item = consignacoes.find(c => c.id === id);
  document.getElementById('c_id').value = item.id;
  document.getElementById('c_nome').value = item.nome;
  document.getElementById('c_valor').value = displayCurrency(item.valor);
  document.getElementById('c_juros').value = item.juros.toFixed(2);
  document.getElementById('c_parcelas').value = item.parcelas;
  document.getElementById('c_vencimento').value = item.vencimento;
  document.getElementById('c_contato').value = item.contato || '';
  
  document.getElementById('consigFormTitle').textContent = "Editando Empr√©stimo";
  document.getElementById('btnSaveCons').textContent = "Salvar Altera√ß√µes";
  document.getElementById('btnCancelCons').style.display = "inline-block";
  document.getElementById('formConsignacao').classList.add('editing');
  
  document.getElementById('formConsignacao').scrollIntoView({behavior: 'smooth', block: 'start'});
}

function resetConsForm() {
  document.getElementById('c_id').value = "";
  document.getElementById('c_nome').value = "";
  document.getElementById('c_valor').value = "";
  document.getElementById('c_juros').value = "";
  document.getElementById('c_parcelas').value = "";
  document.getElementById('c_vencimento').value = "";
  document.getElementById('c_contato').value = "";
  document.getElementById('consigFormTitle').textContent = "Novo Empr√©stimo";
  document.getElementById('btnSaveCons').textContent = "Adicionar Empr√©stimo";
  document.getElementById('btnCancelCons').style.display = "none";
  document.getElementById('formConsignacao').classList.remove('editing');
}

function deleteConsignacao(id) {
  if (confirm('Deseja realmente excluir este empr√©stimo?')) {
    consignacoes = consignacoes.filter(item => item.id !== id);
    localStorage.setItem('consignacoes', JSON.stringify(consignacoes));
    renderConsignacoes();
    renderConsignacaoSummary();
    renderConsignacaoChart();
  }
}

function renderConsignacaoSummary() {
  let totalEmp = 0;
  let totalRec = 0;
  let totalAtraso = 0;
  
  consignacoes.forEach(item => {
    totalEmp += item.total;
    totalRec += item.pago;
    
    if (item.pago < item.total && new Date(item.vencimento) < new Date()) {
      totalAtraso++;
    }
  });
  
  document.getElementById('totalEmprestado').textContent = 'R$ ' + displayCurrency(totalEmp);
  document.getElementById('totalRecebido').textContent = 'R$ ' + displayCurrency(totalRec);
  document.getElementById('totalAberto').textContent = 'R$ ' + displayCurrency(totalEmp - totalRec);
  document.getElementById('totalAtrasado').textContent = totalAtraso;
}

function renderConsignacaoChart() {
  let totalEmp = 0;
  let totalRec = 0;
  
  consignacoes.forEach(item => {
    totalEmp += item.total;
    totalRec += item.pago;
  });
  
  const ctx = document.getElementById('consignacaoChart');
  
  if (consignacaoChart) {
    consignacaoChart.destroy();
  }
  
  consignacaoChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Emprestado (Total)', 'Recebido (Pago)'],
      datasets: [{
        label: 'Valores em R$',
        data: [totalEmp, totalRec],
        backgroundColor: [
          'rgba(102, 126, 234, 0.8)',
          'rgba(40, 167, 69, 0.8)'
        ],
        borderColor: [
          'rgba(102, 126, 234, 1)',
          'rgba(40, 167, 69, 1)'
        ],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return 'R$ ' + displayCurrency(context.parsed.y);
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return 'R$ ' + displayCurrency(value);
            }
          }
        }
      }
    }
  });
}

function exportConsignacaoCSV() {
  if (consignacoes.length === 0) {
    alert('N√£o h√° dados para exportar!');
    return;
  }
  
  let csv = 'Nome,Valor Inicial,Juros (%),Total com Juros,Pago,Restante,Vencimento,Status\n';
  
  consignacoes.forEach(item => {
    let status = 'Em Aberto';
    if (item.pago >= item.total) {
      status = 'Pago';
    } else if (new Date(item.vencimento) < new Date()) {
      status = 'Atrasado';
    }
    
    const restante = item.total - item.pago;
    
    csv += `${item.nome},${item.valor.toFixed(2)},${item.juros.toFixed(2)},${item.total.toFixed(2)},${item.pago.toFixed(2)},${restante.toFixed(2)},${item.vencimento},${status}\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  
  link.setAttribute('href', url);
  link.setAttribute('download', 'consignacoes.csv');
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  alert('Arquivo consignacoes.csv exportado com sucesso!');
}

function exportConsignacaoPDF() {
  if (consignacoes.length === 0) {
    alert('N√£o h√° dados para exportar!');
    return;
  }
  
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  
  pdf.setFontSize(16);
  pdf.text('Relat√≥rio de Empr√©stimos', 10, 10);
  
  pdf.setFontSize(10);
  let y = 25;
  
  consignacoes.forEach((item, index) => {
    if (y > 270) {
      pdf.addPage();
      y = 10;
    }
    
    let status = 'Em Aberto';
    if (item.pago >= item.total) {
      status = 'Pago';
    } else if (new Date(item.vencimento) < new Date()) {
      status = 'Atrasado';
    }
    
    const restante = item.total - item.pago;
    
    pdf.text(`${index + 1}. ${item.nome}`, 10, y);
    y += 6;
    pdf.text(`   Valor: R$ ${displayCurrency(item.valor)} | Juros: ${item.juros.toFixed(2)}% | Total: R$ ${displayCurrency(item.total)}`, 10, y);
    y += 6;
    pdf.text(`   Pago: R$ ${displayCurrency(item.pago)} | Restante: R$ ${displayCurrency(restante)} | Status: ${status}`, 10, y);
    y += 6;
    pdf.text(`   Vencimento: ${new Date(item.vencimento).toLocaleDateString('pt-BR')} | Parcelas: ${item.parcelas}`, 10, y);
    y += 10;
  });
  
  pdf.save('consignacoes.pdf');
  alert('Arquivo consignacoes.pdf exportado com sucesso!');
}

// ==================== ANOTA√á√ïES ====================
function saveAnotacao() {
  const id = document.getElementById('a_id').value;
  const item = {
    id: id ? parseInt(id) : Date.now(),
    titulo: document.getElementById('a_titulo').value,
    notas: document.getElementById('a_notas').value,
    prioridade: document.getElementById('a_prioridade').value
  };
  
  if (!item.titulo) {
    alert('Preencha o t√≠tulo!');
    return;
  }
  
  if (id) {
    const index = anotacoes.findIndex(a => a.id === item.id);
    anotacoes[index] = item;
  } else {
    anotacoes.push(item);
  }
  
  localStorage.setItem('anotacoes', JSON.stringify(anotacoes));
  resetAnotForm();
  renderAnotacoes();
  renderAnotacoesPrioritySummary();
}

function renderAnotacoes(filtered = null) {
  const data = filtered || anotacoes;
  const table = document.getElementById('anotacoesTable');
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = '';
  
  const sortedData = [...data].reverse();
  
  sortedData.forEach(item => {
    const row = tbody.insertRow(-1);
    const prioColor = item.prioridade === 'Alta' ? '#e74c3c' : item.prioridade === 'M√©dia' ? '#f39c12' : '#95a5a6';
    
    row.innerHTML = `
      <td><strong>${item.titulo}</strong></td>
      <td><span style="padding: 4px 8px; border-radius: 4px; background: ${prioColor}; color: white;">${item.prioridade}</span></td>
      <td>${item.notas || '-'}</td>
      <td>
        <button class="btn-edit" onclick="editAnotacao(${item.id})">Editar</button>
        <button class="btn-delete" onclick="deleteAnotacao(${item.id})">Excluir</button>
      </td>
    `;
  });
}

function editAnotacao(id) {
  const item = anotacoes.find(a => a.id === id);
  document.getElementById('a_id').value = item.id;
  document.getElementById('a_titulo').value = item.titulo;
  document.getElementById('a_notas').value = item.notas || '';
  document.getElementById('a_prioridade').value = item.prioridade;
  
  document.getElementById('anotFormTitle').textContent = "Editando Anota√ß√£o";
  document.getElementById('btnSaveAnot').textContent = "Salvar Altera√ß√µes";
  document.getElementById('btnCancelAnot').style.display = "inline-block";
  document.getElementById('formAnot').classList.add('editing');
  
  document.getElementById('formAnot').scrollIntoView({behavior: 'smooth', block: 'start'});
}

function resetAnotForm() {
  document.getElementById('a_id').value = "";
  document.getElementById('a_titulo').value = "";
  document.getElementById('a_notas').value = "";
  document.getElementById('a_prioridade').selectedIndex = 0;
  document.getElementById('anotFormTitle').textContent = "Nova Anota√ß√£o";
  document.getElementById('btnSaveAnot').textContent = "Adicionar Anota√ß√£o";
  document.getElementById('btnCancelAnot').style.display = "none";
  document.getElementById('formAnot').classList.remove('editing');
}

function deleteAnotacao(id) {
  if (confirm('Deseja realmente excluir esta anota√ß√£o?')) {
    anotacoes = anotacoes.filter(item => item.id !== id);
    localStorage.setItem('anotacoes', JSON.stringify(anotacoes));
    renderAnotacoes();
    renderAnotacoesPrioritySummary();
  }
}

function renderAnotacoesPrioritySummary() {
  const summary = { 'Alta': 0, 'M√©dia': 0, 'Baixa': 0 };
  
  anotacoes.forEach(item => {
    summary[item.prioridade]++;
  });
  
  const container = document.getElementById('anotacoesPrioritySummary');
  container.innerHTML = '';
  
  Object.keys(summary).forEach(prioridade => {
    const card = document.createElement('div');
    card.className = 'summary-card';
    
    if (prioridade === 'Alta') {
      card.classList.add('danger');
    } else if (prioridade === 'M√©dia') {
      card.classList.add('warning');
    }
    
    card.innerHTML = `
      <h4>Prioridade ${prioridade}</h4>
      <p>${summary[prioridade]}</p>
      <small style="opacity: 0.8; font-size: 12px;">anota√ß√µes</small>
    `;
    container.appendChild(card);
  });
}

// ==================== VENDAS ====================
function saveVenda() {
  const item = {
    id: Date.now(),
    cliente: document.getElementById('v_cliente').value,
    tipo: document.getElementById('v_tipo').value,
    custo: parseCurrency(document.getElementById('v_custo').value),
    valor: parseCurrency(document.getElementById('v_valor').value),
    descricao: document.getElementById('v_descricao').value,
    data: new Date().toISOString(),
    oculto: false
  };

  if (!item.cliente || item.valor === 0) {
    alert('Preencha os dados b√°sicos da venda (Cliente e Valor).');
    return;
  }

  vendas.push(item);
  localStorage.setItem('vendas', JSON.stringify(vendas));
  renderVendas();
  limparFormVendas();
}

function renderVendas() {
  const tbody = document.querySelector('#vendasTable tbody');
  tbody.innerHTML = '';
  
  let bruto = 0;
  let lucroTotal = 0;

  vendas.forEach(item => {
    if (item.oculto) return;

    const lucro = item.valor - item.custo;
    bruto += item.valor;
    lucroTotal += lucro;

    const row = tbody.insertRow();
    row.innerHTML = `
      <td>${new Date(item.data).toLocaleDateString('pt-BR')}</td>
      <td>${item.cliente}</td>
      <td>R$ ${displayCurrency(item.valor)}</td>
      <td style="color: ${lucro >= 0 ? 'green' : 'red'}">R$ ${displayCurrency(lucro)}</td>
      <td>
        <button class="btn-secondary" onclick="toggleOcultarVenda(${item.id})">Ocultar</button>
        <button class="btn-delete" onclick="deleteVenda(${item.id})">Excluir</button>
      </td>
    `;
  });

  document.getElementById('totalVendasBruto').textContent = 'R$ ' + displayCurrency(bruto);
  document.getElementById('totalLucroVendas').textContent = 'R$ ' + displayCurrency(lucroTotal);
}

function toggleOcultarVenda(id) {
  const index = vendas.findIndex(v => v.id === id);
  vendas[index].oculto = true;
  localStorage.setItem('vendas', JSON.stringify(vendas));
  renderVendas();
}

function deleteVenda(id) {
  if(confirm("Excluir permanentemente esta venda?")) {
    vendas = vendas.filter(v => v.id !== id);
    localStorage.setItem('vendas', JSON.stringify(vendas));
    renderVendas();
  }
}

function limparFormVendas() {
  document.getElementById('v_cliente').value = '';
  document.getElementById('v_tipo').selectedIndex = 0;
  document.getElementById('v_custo').value = '';
  document.getElementById('v_valor').value = '';
  document.getElementById('v_descricao').value = '';
}

// ==================== DASHBOARD ====================
function renderDashboard() {
  let totalRec = 0;
  let totalDesp = 0;
  
  financeiro.forEach(item => {
    const valorRecorrente = calculateRecurringValue(item.valor, item.data, item.recorrente);
    
    if (item.tipo === 'Recebido' || item.tipo === 'A Receber') {
      totalRec += valorRecorrente;
    } else {
      totalDesp += valorRecorrente;
    }
  });
  
  const saldo = totalRec - totalDesp;
  
  let totalInvest = 0;
  let totalProv = 0;
  
  investimentos.forEach(item => {
    totalInvest += item.valor;
    const proventoRecorrente = calculateRecurringValue(item.provento, item.data, item.recorrente);
    totalProv += proventoRecorrente;
  });
  
  let totalEmprestimos = 0;
  consignacoes.forEach(item => {
    totalEmprestimos += (item.total - item.pago);
  });
  
  const patrimonio = saldo + totalInvest + totalEmprestimos;
  
  document.getElementById('dashSaldo').textContent = 'R$ ' + displayCurrency(saldo);
  document.getElementById('dashInvest').textContent = 'R$ ' + displayCurrency(totalInvest);
  document.getElementById('dashProv').textContent = 'R$ ' + displayCurrency(totalProv);
  document.getElementById('dashEmprestimos').textContent = 'R$ ' + displayCurrency(totalEmprestimos);
  document.getElementById('dashPatrimonio').textContent = 'R$ ' + displayCurrency(patrimonio);
  
  document.getElementById('totalReceitas').textContent = 'R$ ' + displayCurrency(totalRec);
  document.getElementById('totalDespesas').textContent = 'R$ ' + displayCurrency(totalDesp);
  document.getElementById('numTransacoes').textContent = financeiro.length;
  document.getElementById('numInvestimentos').textContent = investimentos.length;
  document.getElementById('numEmprestimos').textContent = consignacoes.length;
  document.getElementById('numAnotacoes').textContent = anotacoes.length;
}
// ==================== ORDENA√á√ÉO DE TABELAS ====================
function sortTable(tableId, columnIndex) {
  const table = document.getElementById(tableId);
  const tbody = table.querySelector('tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  const header = table.querySelectorAll('th')[columnIndex];
  
  const isAsc = header.classList.contains('sorted-asc');
  
  table.querySelectorAll('th').forEach(th => {
    th.classList.remove('sorted-asc', 'sorted-desc');
  });
  
  if (isAsc) {
    header.classList.add('sorted-desc');
  } else {
    header.classList.add('sorted-asc');
  }
  
  rows.sort((a, b) => {
    const aText = a.cells[columnIndex].textContent.trim();
    const bText = b.cells[columnIndex].textContent.trim();
    
    const aNum = parseFloat(aText.replace(/[^\d,-]/g, '').replace(',', '.'));
    const bNum = parseFloat(bText.replace(/[^\d,-]/g, '').replace(',', '.'));
    
    if (!isNaN(aNum) && !isNaN(bNum)) {
      return isAsc ? bNum - aNum : aNum - bNum;
    }
    
    return isAsc ? bText.localeCompare(aText) : aText.localeCompare(bText);
  });
  
  rows.forEach(row => tbody.appendChild(row));
}

// ==================== EXPORTAR CSV ====================
function exportToCSV(tipo) {
  let data;
  let filename;
  
  if (tipo === 'financeiro') {
    data = financeiro;
    filename = 'financeiro.csv';
  } else if (tipo === 'investimento') {
    data = investimentos;
    filename = 'investimentos.csv';
  } else if (tipo === 'anotacoes') {
    data = anotacoes;
    filename = 'anotacoes.csv';
  } else if (tipo === 'vendas') {
    data = vendas;
    filename = 'vendas.csv';
  }
  
  if (!data || data.length === 0) {
    alert('N√£o h√° dados para exportar!');
    return;
  }
  
  const headers = Object.keys(data[0]);
  const csv = [
    headers.join(','),
    ...data.map(row => headers.map(key => {
      const value = row[key];
      return typeof value === 'string' && (value.includes(',') || value.includes('\n')) 
        ? `"${value}"` 
        : value;
    }).join(','))
  ].join('\n');
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  
  link.setAttribute('href', url);
  link.setAttribute('download', filename);
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  alert(`Arquivo ${filename} exportado com sucesso!`);
}

// Adicione aqui o resto das fun√ß√µes do sistema original...
// (renderDashboard, renderConsignacoes, renderAnotacoes, renderVendas, etc.)
// ==================== FILTROS AVAN√áADOS - FINANCEIRO ====================
function filtrarHoje(tipo) {
  const hoje = new Date();
  hoje.setHours(0, 0, 0, 0);
  const amanha = new Date(hoje);
  amanha.setDate(amanha.getDate() + 1);
  
  const filtered = financeiro.filter(item => {
    const itemDate = new Date(item.data);
    return itemDate >= hoje && itemDate < amanha;
  });
  
  renderFinanceiro(filtered);
  alert(`Mostrando ${filtered.length} transa√ß√£o(√µes) de hoje`);
}

function filtrarSemana(tipo) {
  const hoje = new Date();
  const primeiroDia = new Date(hoje);
  primeiroDia.setDate(hoje.getDate() - hoje.getDay());
  primeiroDia.setHours(0, 0, 0, 0);
  
  const filtered = financeiro.filter(item => {
    const itemDate = new Date(item.data);
    return itemDate >= primeiroDia;
  });
  
  renderFinanceiro(filtered);
  alert(`Mostrando ${filtered.length} transa√ß√£o(√µes) desta semana`);
}

function filtrarMes(tipo) {
  const hoje = new Date();
  const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
  
  const filtered = financeiro.filter(item => {
    const itemDate = new Date(item.data);
    return itemDate >= primeiroDia;
  });
  
  renderFinanceiro(filtered);
  alert(`Mostrando ${filtered.length} transa√ß√£o(√µes) deste m√™s`);
}

function mostrarTodos(tipo) {
  renderFinanceiro();
  document.getElementById('searchFinanceiro').value = '';
  alert('Mostrando todas as transa√ß√µes');
}

function buscarFinanceiro() {
  const termo = document.getElementById('searchFinanceiro').value.toLowerCase();
  
  if (!termo) {
    renderFinanceiro();
    return;
  }
  
  const filtered = financeiro.filter(item => {
    return item.descricao.toLowerCase().includes(termo) ||
           item.categoria.toLowerCase().includes(termo) ||
           item.tipo.toLowerCase().includes(termo) ||
           item.valor.toString().includes(termo);
  });
  
  renderFinanceiro(filtered);
}

// ==================== FILTROS - INVESTIMENTOS ====================
let investimentosFiltrados = null;

function buscarInvestimentos() {
  const termo = document.getElementById('searchInvestimentos').value.toLowerCase();
  
  if (!termo) {
    renderInvestimentos(investimentosFiltrados);
    return;
  }
  
  const base = investimentosFiltrados || investimentos;
  const filtered = base.filter(item => {
    return item.ativo.toLowerCase().includes(termo) ||
           item.modalidade.toLowerCase().includes(termo);
  });
  
  renderInvestimentos(filtered);
}

function filtrarInvestimentos() {
  const modalidade = document.getElementById('filterInvModalidade').value;
  
  if (!modalidade) {
    investimentosFiltrados = null;
    renderInvestimentos();
    return;
  }
  
  investimentosFiltrados = investimentos.filter(item => item.modalidade === modalidade);
  renderInvestimentos(investimentosFiltrados);
}

function limparFiltrosInvestimentos() {
  document.getElementById('searchInvestimentos').value = '';
  document.getElementById('filterInvModalidade').value = '';
  investimentosFiltrados = null;
  renderInvestimentos();
}

// ==================== FILTROS - CONSIGNA√á√ÉO ====================
let consignacoesFiltradas = null;

function buscarConsignacao() {
  const termo = document.getElementById('searchConsignacao').value.toLowerCase();
  
  if (!termo) {
    renderConsignacoes();
    return;
  }
  
  const filtered = consignacoes.filter(item => {
    return item.nome.toLowerCase().includes(termo) ||
           (item.contato && item.contato.toLowerCase().includes(termo));
  });
  
  consignacoesFiltradas = filtered;
  renderConsignacoes();
}

function filtrarConsignacao() {
  const status = document.getElementById('filterConsStatus').value;
  const dataInicio = document.getElementById('filterConsDataInicio').value;
  const dataFim = document.getElementById('filterConsDataFim').value;
  
  let filtered = [...consignacoes];
  
  // Filtrar por status
  if (status) {
    filtered = filtered.filter(item => {
      if (status === 'pago') {
        return item.pago >= item.total;
      } else if (status === 'atrasado') {
        return item.pago < item.total && new Date(item.vencimento) < new Date();
      } else if (status === 'aberto') {
        return item.pago < item.total && new Date(item.vencimento) >= new Date();
      }
      return true;
    });
  }
  
  // Filtrar por data
  if (dataInicio) {
    filtered = filtered.filter(item => new Date(item.vencimento) >= new Date(dataInicio));
  }
  if (dataFim) {
    filtered = filtered.filter(item => new Date(item.vencimento) <= new Date(dataFim + 'T23:59:59'));
  }
  
  consignacoesFiltradas = filtered;
  
  // Renderizar apenas a tabela
  const table = document.getElementById('consignacaoTable');
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = '';
  
  const sortedData = [...filtered].sort((a, b) => new Date(a.vencimento) - new Date(b.vencimento));
  
  sortedData.forEach(item => {
    const row = tbody.insertRow(-1);
    
    let status = 'Em Aberto';
    let statusClass = 'status-aberto';
    
    if (item.pago >= item.total) {
      status = 'Pago';
      statusClass = 'status-pago';
    } else if (new Date(item.vencimento) < new Date()) {
      status = 'Atrasado';
      statusClass = 'status-atrasado';
    }
    
    const restante = item.total - item.pago;
    const valorParcela = item.total / item.parcelas;
    
    row.innerHTML = `
      <td><strong>${item.nome}</strong>${item.contato ? '<br><small>' + item.contato + '</small>' : ''}</td>
      <td>R$ ${displayCurrency(item.valor)}</td>
      <td>${item.juros.toFixed(2)}%</td>
      <td>R$ ${displayCurrency(item.total)}</td>
      <td>R$ ${displayCurrency(item.pago)}<br><small>Restam: R$ ${displayCurrency(restante)}</small></td>
      <td>${new Date(item.vencimento).toLocaleDateString('pt-BR')}<br><small>${item.parcelas}x de R$ ${displayCurrency(valorParcela)}</small></td>
      <td><span class="${statusClass}">${status}</span></td>
      <td>
        <button class="btn-success" onclick="pagarParcela(${item.id})" ${item.pago >= item.total ? 'disabled' : ''}>Pagar Parcela</button><br>
        <button class="btn-edit" onclick="editConsignacao(${item.id})" style="margin-top:5px">Editar</button>
        <button class="btn-delete" onclick="deleteConsignacao(${item.id})" style="margin-top:5px">Excluir</button>
      </td>
    `;
  });
  
  alert(`Mostrando ${filtered.length} empr√©stimo(s)`);
}

function limparFiltrosConsignacao() {
  document.getElementById('searchConsignacao').value = '';
  document.getElementById('filterConsStatus').value = '';
  document.getElementById('filterConsDataInicio').value = '';
  document.getElementById('filterConsDataFim').value = '';
  consignacoesFiltradas = null;
  renderConsignacoes();
}

// ==================== FILTROS - ANOTA√á√ïES ====================
let anotacoesFiltradas = null;

function buscarAnotacoes() {
  const termo = document.getElementById('searchAnotacoes').value.toLowerCase();
  
  if (!termo) {
    renderAnotacoes(anotacoesFiltradas);
    return;
  }
  
  const base = anotacoesFiltradas || anotacoes;
  const filtered = base.filter(item => {
    return item.titulo.toLowerCase().includes(termo) ||
           (item.notas && item.notas.toLowerCase().includes(termo));
  });
  
  renderAnotacoes(filtered);
}

function filtrarAnotacoes() {
  const prioridade = document.getElementById('filterAnotPrioridade').value;
  
  if (!prioridade) {
    anotacoesFiltradas = null;
    renderAnotacoes();
    return;
  }
  
  anotacoesFiltradas = anotacoes.filter(item => item.prioridade === prioridade);
  renderAnotacoes(anotacoesFiltradas);
}

function limparFiltrosAnotacoes() {
  document.getElementById('searchAnotacoes').value = '';
  document.getElementById('filterAnotPrioridade').value = '';
  anotacoesFiltradas = null;
  renderAnotacoes();
}

// ==================== FILTROS - VENDAS ====================
let vendasFiltradas = null;

function buscarVendas() {
  const termo = document.getElementById('searchVendas').value.toLowerCase();
  
  if (!termo) {
    renderVendas();
    return;
  }
  
  const filtered = vendas.filter(item => {
    return !item.oculto && (
      item.cliente.toLowerCase().includes(termo) ||
      (item.descricao && item.descricao.toLowerCase().includes(termo))
    );
  });
  
  // Renderizar filtrado
  const tbody = document.querySelector('#vendasTable tbody');
  tbody.innerHTML = '';
  
  let bruto = 0;
  let lucroTotal = 0;

  filtered.forEach(item => {
    const lucro = item.valor - item.custo;
    bruto += item.valor;
    lucroTotal += lucro;

    const row = tbody.insertRow();
    row.innerHTML = `
      <td>${new Date(item.data).toLocaleDateString('pt-BR')}</td>
      <td>${item.cliente}</td>
      <td>R$ ${displayCurrency(item.valor)}</td>
      <td style="color: ${lucro >= 0 ? 'green' : 'red'}">R$ ${displayCurrency(lucro)}</td>
      <td>
        <button class="btn-secondary" onclick="toggleOcultarVenda(${item.id})">Ocultar</button>
        <button class="btn-delete" onclick="deleteVenda(${item.id})">Excluir</button>
      </td>
    `;
  });

  document.getElementById('totalVendasBruto').textContent = 'R$ ' + displayCurrency(bruto);
  document.getElementById('totalLucroVendas').textContent = 'R$ ' + displayCurrency(lucroTotal);
}

function filtrarVendas() {
  const tipo = document.getElementById('filterVendasTipo').value;
  const dataInicio = document.getElementById('filterVendasDataInicio').value;
  const dataFim = document.getElementById('filterVendasDataFim').value;
  
  let filtered = vendas.filter(item => !item.oculto);
  
  if (tipo) {
    filtered = filtered.filter(item => item.tipo === tipo);
  }
  
  if (dataInicio) {
    filtered = filtered.filter(item => new Date(item.data) >= new Date(dataInicio));
  }
  
  if (dataFim) {
    filtered = filtered.filter(item => new Date(item.data) <= new Date(dataFim + 'T23:59:59'));
  }
  
  // Renderizar filtrado
  const tbody = document.querySelector('#vendasTable tbody');
  tbody.innerHTML = '';
  
  let bruto = 0;
  let lucroTotal = 0;

  filtered.forEach(item => {
    const lucro = item.valor - item.custo;
    bruto += item.valor;
    lucroTotal += lucro;

    const row = tbody.insertRow();
    row.innerHTML = `
      <td>${new Date(item.data).toLocaleDateString('pt-BR')}</td>
      <td>${item.cliente}</td>
      <td>R$ ${displayCurrency(item.valor)}</td>
      <td style="color: ${lucro >= 0 ? 'green' : 'red'}">R$ ${displayCurrency(lucro)}</td>
      <td>
        <button class="btn-secondary" onclick="toggleOcultarVenda(${item.id})">Ocultar</button>
        <button class="btn-delete" onclick="deleteVenda(${item.id})">Excluir</button>
      </td>
    `;
  });

  document.getElementById('totalVendasBruto').textContent = 'R$ ' + displayCurrency(bruto);
  document.getElementById('totalLucroVendas').textContent = 'R$ ' + displayCurrency(lucroTotal);
  
  alert(`Mostrando ${filtered.length} venda(s)`);
}

function limparFiltrosVendas() {
  document.getElementById('searchVendas').value = '';
  document.getElementById('filterVendasTipo').value = '';
  document.getElementById('filterVendasDataInicio').value = '';
  document.getElementById('filterVendasDataFim').value = '';
  renderVendas();
}

</script>

</body>
</html>
